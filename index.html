<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thynk POS - Complete Hotel Management System</title>
    
    <!-- Working Logo & Favicon -->
    <link rel="icon" href="https://i.postimg.cc/yNQxnFd1/thynk.png" type="image/png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/yNQxnFd1/thynk.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGh5bmsgUE9TIC0gSG90ZWwgTWFuYWdlbWVudCIsInNob3J0X25hbWUiOiJUaHluayBQT1MiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzNiODJmNiIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2kucG9zdGltZy5jYy95TlF4bkZkMS90aHluay5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
    
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Thynk POS">
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light: #f8fafc;
            --dark: #1f2937;
            --white: #ffffff;
            --border: #e5e7eb;
            --text: #374151;
            --text-light: #6b7280;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: url('https://i.postimg.cc/yNQxnFd1/thynk.png') no-repeat center;
            background-size: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            transition: var(--transition);
        }

        .logo-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--dark);
        }

        /* Main App Container */
        .app { padding: 2rem 0; min-height: calc(100vh - 80px); }

        .app-container {
            background: var(--white);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .app-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .app-subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Statistics Cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            background: var(--light);
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            text-align: center;
            border-right: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:last-child { border-right: none; }
        .stat-card:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: var(--transition);
        }

        .stat-card:hover::before { transform: scaleX(1); }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: var(--white);
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--light);
            padding: 0.5rem;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: var(--dark);
        }

        .tab:hover { 
            background: rgba(59, 130, 246, 0.1);
            color: var(--dark);
        }
        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .tab-content { padding: 2rem; min-height: 500px; }
        .tab-pane { display: none; animation: fadeIn 0.5s ease; }
        .tab-pane.active { display: block; }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            font-family: inherit;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before { left: 100%; }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--white);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: var(--white);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #0891b2);
            color: var(--white);
        }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }

        /* Form Groups */
        .form-group { display: flex; flex-direction: column; margin-bottom: 1rem; }

        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input {
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
            font-family: inherit;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Searchable Menu Input - FIXED */
        .menu-search-container {
            position: relative;
        }

        .menu-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .menu-suggestion {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .menu-suggestion:hover {
            background: var(--light);
        }

        .menu-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-menu-name {
            font-weight: 600;
            color: var(--dark);
        }

        .suggestion-menu-price {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* Customer Search */
        .customer-search-container {
            position: relative;
        }

        .customer-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .customer-suggestion {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .customer-suggestion:hover {
            background: var(--light);
        }

        .customer-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: var(--dark);
        }

        .suggestion-contact {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* Form Sections */
        .form-section {
            background: var(--light);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        /* Payment Section */
        .payment-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .price-display {
            text-align: center;
            padding: 2rem;
            background: var(--light);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .original-price {
            font-size: 1.5rem;
            text-decoration: line-through;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .final-price {
            font-size: 3rem;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .discount-badge {
            background: var(--success);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
        }

        .payment-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .payment-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .gpay-btn {
            background: #4285f4;
            color: white;
        }

        .gpay-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .upi-btn {
            background: #ff6600;
            color: white;
        }

        .upi-btn:hover {
            background: #e55a00;
            transform: translateY(-2px);
        }

        /* Footer */
        .footer {
            background: var(--light);
            padding: 1rem 2rem;
            text-align: center;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .version-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .version-badge {
            background: var(--primary);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .creator-text {
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
                gap: 0.25rem;
            }

            .tab { justify-content: flex-start; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .payment-buttons { grid-template-columns: 1fr; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.3s ease;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <div class="logo-icon"></div>
                <div class="logo-text">Thynk POS</div>
            </div>
            <div>
                <button class="btn btn-warning" onclick="showSubscriptionTab()">
                    <span class="material-icons-outlined">star</span>
                    Premium
                </button>
            </div>
        </nav>
    </header>

    <!-- Main App -->
    <main class="app">
        <div class="container">
            <div class="app-container">
                <!-- App Header -->
                <div class="app-header">
                    <div class="app-title">Thynk POS - Complete Hotel Management</div>
                    <div class="app-subtitle">All-in-One Control for Hotels That Don't Compromise.</div>
                </div>

                <!-- Statistics -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">table_restaurant</span>
                        </div>
                        <div class="stat-value" id="totalTables">0</div>
                        <div class="stat-label">Total Tables/Rooms</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">receipt_long</span>
                        </div>
                        <div class="stat-value" id="billCount">0</div>
                        <div class="stat-label">Bills Generated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">people</span>
                        </div>
                        <div class="stat-value" id="customerCount">0</div>
                        <div class="stat-label">Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">restaurant_menu</span>
                        </div>
                        <div class="stat-value" id="menuCount">0</div>
                        <div class="stat-label">Menu Items</div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('tables')">
                        <span class="material-icons-outlined">table_restaurant</span>
                        Table/Room Management
                    </button>
                    <button class="tab" onclick="switchTab('menu')">
                        <span class="material-icons-outlined">restaurant_menu</span>
                        Menu Management
                    </button>
                    <button class="tab" onclick="switchTab('billing')">
                        <span class="material-icons-outlined">receipt_long</span>
                        Billing Software
                    </button>
                    <button class="tab" onclick="switchTab('customers')">
                        <span class="material-icons-outlined">people</span>
                        Customer Management
                    </button>
                    <button class="tab" onclick="switchTab('history')">
                        <span class="material-icons-outlined">history</span>
                        History & Reports
                    </button>
                    <button class="tab" onclick="switchTab('subscription')">
                        <span class="material-icons-outlined">star</span>
                        Premium Subscription
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Table/Room Management Tab -->
                    <div class="tab-pane active" id="tables-tab">
                        <h2>Table/Room Management</h2>
                        <p>Table management features will be here.</p>
                    </div>

                    <!-- Menu Management Tab -->
                    <div class="tab-pane" id="menu-tab">
                        <h2>Menu Management</h2>
                        <p>Menu management features will be here.</p>
                    </div>

                    <!-- Enhanced Billing Software Tab -->
                    <div class="tab-pane" id="billing-tab">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>Enhanced Billing Software</h2>
                            <button class="btn btn-primary" onclick="showNewBillForm()">
                                <span class="material-icons-outlined">add</span>
                                Add Items to Order
                            </button>
                        </div>

                        <!-- Billing Form -->
                        <div class="form-section" id="billForm" style="display: none;">
                            <h3 style="margin-bottom: 1.5rem;">Add Items to Order</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Table/Room FIRST *</label>
                                    <select class="form-input" id="billTableSelect">
                                        <option value="">Select Table/Room</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <div class="customer-search-container">
                                        <input type="text" class="form-input" id="customerSearchInput" placeholder="Type customer name to search..." autocomplete="off">
                                        <div class="customer-suggestions" id="customerSuggestions"></div>
                                    </div>
                                    <input type="hidden" id="selectedCustomerId">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Menu Item *</label>
                                    <div class="menu-search-container">
                                        <input type="text" class="form-input" id="billMenuInput" placeholder="Type or search dish name..." autocomplete="off">
                                        <div class="menu-suggestions" id="menuSuggestions"></div>
                                        <input type="hidden" id="selectedMenuId">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Price (₹) *</label>
                                    <input type="number" class="form-input" id="menuPriceInput" placeholder="Price" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Quantity *</label>
                                    <input type="number" class="form-input" id="billQuantity" placeholder="Quantity" min="1" value="1">
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-success" onclick="addItemToTableOrder()">
                                    <span class="material-icons-outlined">add_shopping_cart</span>
                                    Add Item
                                </button>
                                <button class="btn btn-danger" onclick="hideBillForm()">
                                    <span class="material-icons-outlined">close</span>
                                    Close
                                </button>
                            </div>
                        </div>

                        <div id="activeOrders">
                            <p>Active orders will be displayed here.</p>
                        </div>
                    </div>

                    <!-- Customer Management Tab -->
                    <div class="tab-pane" id="customers-tab">
                        <h2>Customer Management</h2>
                        <p>Customer management features will be here.</p>
                    </div>

                    <!-- History & Reports Tab -->
                    <div class="tab-pane" id="history-tab">
                        <h2>History & Reports</h2>
                        <p>History and reports will be displayed here.</p>
                    </div>

                    <!-- Premium Subscription Tab -->
                    <div class="tab-pane" id="subscription-tab">
                        <div class="payment-container">
                            <h2 style="text-align: center; margin-bottom: 2rem;">Premium Subscription</h2>
                            
                            <!-- Price Display -->
                            <div class="price-display">
                                <div class="original-price" id="originalPrice" style="display: none;">₹999</div>
                                <div class="final-price" id="finalPrice">₹999</div>
                                <div class="discount-badge" id="discountBadge" style="display: none;">Save ₹500!</div>
                                <p style="margin-top: 1rem; color: var(--text-light);">Lifetime Access • No Monthly Fees • 500 Tables/Rooms</p>
                            </div>

                            <!-- Promo Code Section -->
                            <div style="margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label class="form-label">Promo Code (Optional)</label>
                                    <div style="display: flex; gap: 1rem;">
                                        <input type="text" class="form-input" id="promoCode" placeholder="Enter THP25 for ₹500 discount" style="flex: 1;">
                                        <button class="btn btn-primary" onclick="applyPromoCode()">
                                            <span class="material-icons-outlined">local_offer</span>
                                            Apply
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Payment Buttons -->
                            <div class="payment-buttons">
                                <button class="payment-btn gpay-btn" onclick="redirectToGooglePay()">
                                    <span>💳</span>
                                    Pay with Google Pay
                                </button>
                                <button class="payment-btn upi-btn" onclick="redirectToPhonePe()">
                                    <span>📱</span>
                                    Pay with PhonePe
                                </button>
                                <button class="payment-btn upi-btn" onclick="redirectToPaytm()">
                                    <span>📱</span>
                                    Pay with Paytm
                                </button>
                                <button class="payment-btn upi-btn" onclick="redirectToBhimUPI()">
                                    <span>📱</span>
                                    Pay with BHIM UPI
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="version-info">
            <span class="version-badge">v1.75</span>
            <span class="creator-text">Created by Anas Lila</span>
        </div>
    </footer>

    <script>
        // Enhanced Restaurant Database System
        const RestaurantDB = {
            menu: {
                save: (item) => {
                    const menu = JSON.parse(localStorage.getItem('thynk_menu') || '[]');
                    const newItem = {
                        id: Date.now(),
                        name: item.name,
                        price: parseFloat(item.price),
                        created: new Date().toISOString()
                    };
                    menu.push(newItem);
                    localStorage.setItem('thynk_menu', JSON.stringify(menu));
                    return menu.length;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_menu') || '[]'),
                search: (query) => {
                    const menu = RestaurantDB.menu.getAll();
                    if (!query.trim()) return [];
                    
                    const lowerQuery = query.toLowerCase();
                    return menu.filter(item => 
                        item.name.toLowerCase().includes(lowerQuery)
                    ).slice(0, 5);
                }
            },
            customers: {
                save: (customer) => {
                    const customers = JSON.parse(localStorage.getItem('thynk_customers') || '[]');
                    const newCustomer = {
                        id: Date.now(),
                        name: customer.name,
                        phone: customer.phone || '',
                        email: customer.email || '',
                        created: new Date().toISOString()
                    };
                    customers.push(newCustomer);
                    localStorage.setItem('thynk_customers', JSON.stringify(customers));
                    return customers.length;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_customers') || '[]'),
                search: (query) => {
                    const customers = RestaurantDB.customers.getAll();
                    if (!query.trim()) return [];
                    
                    const lowerQuery = query.toLowerCase();
                    return customers.filter(customer => 
                        customer.name.toLowerCase().includes(lowerQuery) ||
                        customer.phone.includes(query)
                    ).slice(0, 5);
                }
            }
        };

        // Global Variables
        let promoCodeApplied = false;
        let currentAmount = 999;

        // Initialize App on Load
        document.addEventListener('DOMContentLoaded', function() {
            setupSearchHandlers();
            updatePaymentAmount(currentAmount);
            showNotification('Thynk POS loaded successfully!', 'success');
        });

        // Setup search and autocomplete handlers - FIXED
        function setupSearchHandlers() {
            // Menu item search in billing
            const menuInput = document.getElementById('billMenuInput');
            
            if (menuInput) {
                menuInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    if (query.length >= 1) {
                        const suggestions = RestaurantDB.menu.search(query);
                        if (suggestions.length > 0) {
                            showMenuSuggestions(suggestions);
                        } else {
                            hideMenuSuggestions();
                        }
                    } else {
                        hideMenuSuggestions();
                    }
                });

                // Handle new menu item entry - FIXED
                menuInput.addEventListener('blur', function() {
                    const menuName = this.value.trim();
                    const priceInput = document.getElementById('menuPriceInput');
                    const selectedMenuId = document.getElementById('selectedMenuId').value;
                    
                    if (menuName && !selectedMenuId) {
                        // New menu item - make price editable
                        priceInput.readOnly = false;
                        priceInput.placeholder = 'Enter price for new dish';
                        priceInput.focus();
                        
                        // Save new menu item when price is entered - FIXED
                        const saveHandler = function() {
                            const price = parseFloat(priceInput.value);
                            if (price && price > 0) {
                                RestaurantDB.menu.save({
                                    name: menuName,
                                    price: price
                                });
                                
                                // Update the selected menu ID for this new item
                                const newItem = RestaurantDB.menu.getAll().find(item => 
                                    item.name === menuName && item.price === price
                                );
                                if (newItem) {
                                    document.getElementById('selectedMenuId').value = newItem.id;
                                }
                                
                                showNotification(`New dish "${menuName}" added to menu!`, 'success');
                            }
                            priceInput.removeEventListener('blur', saveHandler);
                        };
                        
                        priceInput.addEventListener('blur', saveHandler);
                    }
                });
            }

            // Customer search in billing - FIXED
            const customerInput = document.getElementById('customerSearchInput');
            
            if (customerInput) {
                customerInput.addEventListener('input', function() {
                    const query = this.value.trim();
                    if (query.length >= 1) {
                        const suggestions = RestaurantDB.customers.search(query);
                        if (suggestions.length > 0) {
                            showCustomerSuggestions(suggestions);
                        } else {
                            hideCustomerSuggestions();
                        }
                    } else {
                        hideCustomerSuggestions();
                    }
                });
            }

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.menu-search-container')) {
                    hideMenuSuggestions();
                }
                if (!e.target.closest('.customer-search-container')) {
                    hideCustomerSuggestions();
                }
            });
        }

        // Menu suggestions functions - FIXED
        function showMenuSuggestions(suggestions) {
            const container = document.getElementById('menuSuggestions');
            if (!container) return;
            
            container.innerHTML = suggestions.map(item => `
                <div class="menu-suggestion" onclick="selectMenuItem(${item.id}, '${item.name.replace(/'/g, "\\'")}', ${item.price})">
                    <div class="suggestion-menu-name">${item.name}</div>
                    <div class="suggestion-menu-price">₹${item.price}</div>
                </div>
            `).join('');
            container.style.display = 'block';
        }

        function hideMenuSuggestions() {
            const container = document.getElementById('menuSuggestions');
            if (container) {
                container.style.display = 'none';
            }
        }

        function selectMenuItem(id, name, price) {
            document.getElementById('billMenuInput').value = name;
            document.getElementById('menuPriceInput').value = price;
            document.getElementById('menuPriceInput').readOnly = true;
            document.getElementById('selectedMenuId').value = id;
            hideMenuSuggestions();
        }

        // Customer suggestions functions - FIXED
        function showCustomerSuggestions(suggestions) {
            const container = document.getElementById('customerSuggestions');
            if (!container) return;
            
            container.innerHTML = suggestions.map(customer => `
                <div class="customer-suggestion" onclick="selectCustomer(${customer.id}, '${customer.name.replace(/'/g, "\\'")}', '${customer.phone}')">
                    <div class="suggestion-name">${customer.name}</div>
                    <div class="suggestion-contact">${customer.phone}${customer.email ? ` • ${customer.email}` : ''}</div>
                </div>
            `).join('');
            container.style.display = 'block';
        }

        function hideCustomerSuggestions() {
            const container = document.getElementById('customerSuggestions');
            if (container) {
                container.style.display = 'none';
            }
        }

        function selectCustomer(id, name, phone) {
            document.getElementById('customerSearchInput').value = name;
            document.getElementById('selectedCustomerId').value = id;
            hideCustomerSuggestions();
        }

        // Tab Management - FIXED
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            const targetPane = document.getElementById(`${tabName}-tab`);
            if (targetPane) {
                targetPane.classList.add('active');
            }
        }

        // Show subscription tab
        function showSubscriptionTab() {
            const subscriptionTab = document.querySelector('[onclick="switchTab(\'subscription\')"]');
            if (subscriptionTab) {
                subscriptionTab.click();
            }
        }

        // Billing Functions - FIXED
        function showNewBillForm() {
            const billForm = document.getElementById('billForm');
            if (billForm) {
                billForm.style.display = 'block';
            }
        }

        function hideBillForm() {
            const billForm = document.getElementById('billForm');
            if (billForm) {
                billForm.style.display = 'none';
                resetBillForm();
            }
        }

        function resetBillForm() {
            const elements = [
                'billTableSelect',
                'customerSearchInput', 
                'billMenuInput',
                'menuPriceInput',
                'billQuantity',
                'selectedCustomerId',
                'selectedMenuId'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    if (element.type === 'number' && id === 'billQuantity') {
                        element.value = '1';
                    } else {
                        element.value = '';
                    }
                }
            });
            
            const priceInput = document.getElementById('menuPriceInput');
            if (priceInput) {
                priceInput.readOnly = true;
            }
        }

        function addItemToTableOrder() {
            const tableId = document.getElementById('billTableSelect').value;
            const customerName = document.getElementById('customerSearchInput').value.trim();
            const menuName = document.getElementById('billMenuInput').value.trim();
            const price = parseFloat(document.getElementById('menuPriceInput').value);
            const quantity = parseInt(document.getElementById('billQuantity').value);
            
            if (!tableId) {
                showNotification('Please select a table/room first', 'error');
                return;
            }
            
            if (!customerName) {
                showNotification('Please enter customer name', 'error');
                return;
            }
            
            if (!menuName) {
                showNotification('Please select or enter a menu item', 'error');
                return;
            }
            
            if (!price || price <= 0) {
                showNotification('Please enter a valid price', 'error');
                return;
            }
            
            if (!quantity || quantity <= 0) {
                showNotification('Please enter a valid quantity', 'error');
                return;
            }
            
            // Save customer if new
            const customerId = document.getElementById('selectedCustomerId').value;
            if (!customerId && customerName) {
                RestaurantDB.customers.save({
                    name: customerName,
                    phone: '',
                    email: ''
                });
            }
            
            showNotification(`Added ${quantity}x ${menuName} to order!`, 'success');
            
            // Reset form for next item
            document.getElementById('billMenuInput').value = '';
            document.getElementById('menuPriceInput').value = '';
            document.getElementById('menuPriceInput').readOnly = true;
            document.getElementById('selectedMenuId').value = '';
            document.getElementById('billQuantity').value = '1';
        }

        // UPI Payment Functions with Dynamic Amount (FIXED)
        function getUPILink(provider, amount) {
            const paymentAmount = amount || currentAmount;
            
            const baseLinks = {
                gpay: 'gpay://upi/pay?pa=anaslila@icici&am=499&tn=Thynk POS Premium',
                phonepe: 'phonepe://pay?pa=anaslila@icici&am=499&tn=Thynk POS Premium',
                paytm: 'paytmmp://pay?pa=anaslila@icici&am=499&tn=Thynk POS Premium',
                bhim: 'upi://pay?pa=anaslila@icici&am=499&tn=Thynk POS Premium'
            };
            
            let url = baseLinks[provider.toLowerCase()];
            if (!url) return null;
            
            // Replace the amount param (am=499) with given amount dynamically
            url = url.replace(/am=\d+/, `am=${paymentAmount}`);
            
            return url;
        }

        function redirectToGooglePay() {
            const link = getUPILink('gpay', currentAmount);
            if (link) {
                window.location.href = link;
            } else {
                showNotification('GPay link generation failed', 'error');
            }
        }

        function redirectToPhonePe() {
            const link = getUPILink('phonepe', currentAmount);
            if (link) {
                window.location.href = link;
            } else {
                showNotification('PhonePe link generation failed', 'error');
            }
        }

        function redirectToPaytm() {
            const link = getUPILink('paytm', currentAmount);
            if (link) {
                window.location.href = link;
            } else {
                showNotification('Paytm link generation failed', 'error');
            }
        }

        function redirectToBhimUPI() {
            const link = getUPILink('bhim', currentAmount);
            if (link) {
                window.location.href = link;
            } else {
                showNotification('BHIM UPI link generation failed', 'error');
            }
        }

        function updatePaymentAmount(amount) {
            currentAmount = amount;
            const finalPriceEl = document.getElementById('finalPrice');
            if (finalPriceEl) {
                finalPriceEl.textContent = `₹${amount}`;
            }
        }

        function applyPromoCode() {
            const promoInput = document.getElementById('promoCode');
            if (!promoInput) return;
            
            const promoValue = promoInput.value.trim().toUpperCase();
            
            if (promoValue === 'THP25' && !promoCodeApplied) {
                promoCodeApplied = true;
                currentAmount = 499;
                
                const originalPrice = document.getElementById('originalPrice');
                const finalPrice = document.getElementById('finalPrice');
                const discountBadge = document.getElementById('discountBadge');
                
                if (originalPrice) {
                    originalPrice.textContent = '₹999';
                    originalPrice.style.display = 'block';
                }
                if (finalPrice) finalPrice.textContent = '₹499';
                if (discountBadge) discountBadge.style.display = 'inline-block';
                
                promoInput.disabled = true;
                showNotification('Promo code applied! You saved ₹500', 'success');
            } else if (promoCodeApplied) {
                showNotification('Promo code already applied!', 'error');
            } else {
                showNotification('Invalid promo code!', 'error');
            }
        }

        // Notification System - FIXED
        function showNotification(message, type = 'success') {
            // Remove existing notifications
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideInRight 0.3s ease reverse';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }
            }, 3000);
        }

        // Prevent errors on missing functions
        window.onerror = function(msg, url, line) {
            console.log('Error: ' + msg);
            return true;
        };
    </script>
</body>
</html>
