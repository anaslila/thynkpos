<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thynk POS - Complete Hotel Management System</title>
    
    <!-- Working Logo & Favicon -->
    <link rel="icon" href="https://i.postimg.cc/yNQxnFd1/thynk.png" type="image/png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/yNQxnFd1/thynk.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVGh5bmsgUE9TIC0gSG90ZWwgTWFuYWdlbWVudCIsInNob3J0X25hbWUiOiJUaHluayBQT1MiLCJzdGFydF91cmwiOiIvIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmZmZmZiIsInRoZW1lX2NvbG9yIjoiIzNiODJmNiIsImljb25zIjpbeyJzcmMiOiJodHRwczovL2kucG9zdGltZy5jYy95TlF4bkZkMS90aHluay5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIiwicHVycG9zZSI6ImFueSBtYXNrYWJsZSJ9XX0=">
    
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Thynk POS">
    
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #06b6d4;
            --light: #f8fafc;
            --dark: #1f2937;
            --white: #ffffff;
            --border: #e5e7eb;
            --text: #374151;
            --text-light: #6b7280;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.15);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* Header */
        .header {
            background: var(--white);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--border);
        }

        .nav {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 2rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: url('https://i.postimg.cc/yNQxnFd1/thynk.png') no-repeat center;
            background-size: contain;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            transition: var(--transition);
        }

        .logo-icon:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .logo-text {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--dark);
        }

        /* Main App Container */
        .app { padding: 2rem 0; min-height: calc(100vh - 80px); }

        .app-container {
            background: var(--white);
            border-radius: 24px;
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .app-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            padding: 2rem;
            text-align: center;
        }

        .app-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .app-subtitle {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        /* Statistics Cards */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            background: var(--light);
        }

        .stat-card {
            background: var(--white);
            padding: 2rem;
            text-align: center;
            border-right: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card:last-child { border-right: none; }
        .stat-card:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scaleX(0);
            transition: var(--transition);
        }

        .stat-card:hover::before { transform: scaleX(1); }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: var(--white);
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-light);
            font-weight: 600;
        }

        /* Tabs */
        .tabs {
            display: flex;
            background: var(--light);
            padding: 0.5rem;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            flex: 1;
            padding: 1rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
            color: var(--dark);
        }

        .tab:hover { 
            background: rgba(59, 130, 246, 0.1);
            color: var(--dark);
        }
        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .tab-content { padding: 2rem; min-height: 500px; }
        .tab-pane { display: none; animation: fadeIn 0.5s ease; }
        .tab-pane.active { display: block; }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before { left: 100%; }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--white);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: var(--white);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #0891b2);
            color: var(--white);
        }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }

        /* Table/Room Search Filter */
        .search-filter {
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-bottom: 1.5rem;
            border: 1px solid var(--border);
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder {
            color: var(--text-light);
        }

        /* Enhanced Table Tiles with Different Colors for Table/Room and Status */
        .tiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            padding: 1rem 0;
            max-height: 600px;
            overflow-y: auto;
        }

        .table-tile {
            position: relative;
            min-height: 180px;
            border-radius: 20px;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            flex-direction: column;
            font-weight: 600;
        }

        /* Table Status Colors */
        .table-tile.table.available {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.6),
                rgba(5, 150, 105, 0.4),
                rgba(16, 185, 129, 0.3)
            );
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                0 8px 32px rgba(16, 185, 129, 0.3);
            color: var(--white);
        }

        .table-tile.table.occupied {
            background: linear-gradient(135deg, 
                rgba(239, 68, 68, 0.6),
                rgba(220, 38, 38, 0.4),
                rgba(239, 68, 68, 0.3)
            );
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                0 8px 32px rgba(239, 68, 68, 0.3);
            color: var(--white);
        }

        /* Room Status Colors */
        .table-tile.room.available {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.6),
                rgba(37, 99, 235, 0.4),
                rgba(59, 130, 246, 0.3)
            );
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                0 8px 32px rgba(59, 130, 246, 0.3);
            color: var(--white);
        }

        .table-tile.room.occupied {
            background: linear-gradient(135deg, 
                rgba(245, 158, 11, 0.6),
                rgba(217, 119, 6, 0.4),
                rgba(245, 158, 11, 0.3)
            );
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.6),
                0 8px 32px rgba(245, 158, 11, 0.3);
            color: var(--white);
        }

        .table-tile:hover {
            transform: translateY(-8px) scale(1.02);
            backdrop-filter: blur(30px);
        }

        .table-tile.expanded {
            min-height: 450px;
        }

        .table-tile.hidden {
            display: none;
        }

        /* Tile Header (Always Visible) */
        .tile-header {
            padding: 1.5rem;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .tile-number {
            font-size: 2.2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
            color: inherit;
        }

        .tile-info {
            font-size: 1rem;
            opacity: 0.9;
            color: inherit;
        }

        .tile-price {
            font-size: 0.85rem;
            opacity: 0.8;
            margin-top: 0.25rem;
            color: inherit;
            font-weight: 700;
        }

        .checkin-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            margin-top: 0.5rem;
            display: inline-block;
        }

        /* Tile Details (Sliding Section) */
        .tile-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .tile-details.expanded {
            max-height: 600px;
        }

        .details-content {
            padding: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.3);
        }

        .customer-info {
            text-align: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 8px;
        }

        .menu-items {
            max-height: 120px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .menu-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
        }

        .tile-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tile-remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: rgba(239, 68, 68, 0.9);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
            z-index: 10;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
        }

        .table-tile:hover .tile-remove-btn {
            opacity: 1;
            transform: scale(1);
        }

        .tile-remove-btn:hover {
            background: rgba(220, 38, 38, 0.9);
            transform: scale(1.1);
        }

        /* Searchable Customer Input */
        .customer-search-container {
            position: relative;
        }

        .customer-search {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
        }

        .customer-search:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .customer-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .customer-suggestion {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--light);
            cursor: pointer;
            transition: var(--transition);
        }

        .customer-suggestion:hover {
            background: var(--light);
        }

        .customer-suggestion:last-child {
            border-bottom: none;
        }

        .suggestion-name {
            font-weight: 600;
            color: var(--dark);
        }

        .suggestion-contact {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* Bulk Import Section */
        .bulk-import-section {
            background: var(--info);
            color: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .bulk-import-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .bulk-import-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: var(--white);
            color: var(--info);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .file-input-label:hover {
            background: var(--light);
            transform: translateY(-2px);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease;
        }

        .modal-header {
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--dark);
        }

        /* Form Sections */
        .form-section {
            background: var(--light);
            padding: 2rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            display: block;
        }

        .form-section.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-group { display: flex; flex-direction: column; }

        .form-label {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-input {
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--white);
            color: var(--dark);
        }

        /* Big inputs for new table creation */
        .form-input.big {
            padding: 1.5rem 1.25rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        /* Small inputs for editing */
        .form-input.small {
            padding: 0.5rem 0.75rem;
            font-size: 0.9rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Type Selector Section */
        .type-selector {
            background: var(--primary);
            color: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
            text-align: center;
        }

        .type-selector h3 {
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .type-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .type-btn {
            padding: 1rem 1.5rem;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            background: transparent;
            color: var(--white);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .type-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .type-btn.active {
            background: var(--white);
            color: var(--primary);
            border-color: var(--white);
        }

        /* Check-in/Check-out Alert */
        .checkin-alert {
            background: linear-gradient(135deg, var(--info), #0891b2);
            color: var(--white);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
            text-align: center;
        }

        /* Enhanced Bill Display */
        .bill-display {
            max-width: 450px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .bill-header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        .bill-items {
            margin: 1.5rem 0;
        }

        .bill-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--light);
        }

        .bill-room-charge {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
            background: rgba(245, 158, 11, 0.1);
            border-radius: 8px;
            margin: 0.5rem 0;
            padding-left: 0.5rem;
            padding-right: 0.5rem;
            font-weight: 600;
            color: var(--warning);
        }

        .bill-total {
            text-align: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid var(--border);
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
        }

        .bill-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        /* WhatsApp and Email Share Buttons */
        .whatsapp-btn {
            background: #25d366;
            color: white;
        }

        .whatsapp-btn:hover {
            background: #128c7e;
            transform: translateY(-2px);
        }

        .email-btn {
            background: #ea4335;
            color: white;
        }

        .email-btn:hover {
            background: #d33b2c;
            transform: translateY(-2px);
        }

        /* History Timeline */
        .history-timeline {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem 0;
        }

        .history-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: var(--light);
            border-radius: var(--border-radius);
            position: relative;
        }

        .history-item::before {
            content: '';
            position: absolute;
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 60%;
            background: var(--primary);
            border-radius: 2px;
        }

        .history-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .history-content {
            flex: 1;
        }

        .history-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 0.5rem;
        }

        .history-details {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .history-time {
            font-size: 0.8rem;
            color: var(--text-light);
            opacity: 0.8;
        }

        /* QR Code Container */
        .qr-container {
            text-align: center;
            padding: 2rem;
            background: var(--light);
            border-radius: var(--border-radius);
            margin: 2rem 0;
        }

        .qr-code {
            width: 200px;
            height: 200px;
            margin: 0 auto 1rem;
            border: 4px solid var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        /* Cards */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--info));
            transform: scaleX(0);
            transition: var(--transition);
        }

        .card:hover::before { transform: scaleX(1); }

        /* Controls */
        .controls {
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .tile-counter {
            background: var(--white);
            padding: 1rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            font-weight: 600;
            color: var(--dark);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--text-light);
            background: var(--light);
            border-radius: 16px;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Payment Section */
        .payment-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--white);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
        }

        .price-display {
            text-align: center;
            padding: 2rem;
            background: var(--light);
            border-radius: var(--border-radius);
            margin-bottom: 2rem;
        }

        .original-price {
            font-size: 1.5rem;
            text-decoration: line-through;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .final-price {
            font-size: 3rem;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 0.5rem;
        }

        .discount-badge {
            background: var(--success);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
        }

        .payment-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .payment-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .gpay-btn {
            background: #4285f4;
            color: white;
        }

        .gpay-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }

        .upi-btn {
            background: #ff6600;
            color: white;
        }

        .upi-btn:hover {
            background: #e55a00;
            transform: translateY(-2px);
        }

        /* Footer */
        .footer {
            background: var(--light);
            padding: 1rem 2rem;
            text-align: center;
            border-top: 1px solid var(--border);
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .version-info {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .version-badge {
            background: var(--primary);
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .creator-text {
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
                gap: 0.25rem;
            }

            .tab { justify-content: flex-start; }
            .stats { grid-template-columns: repeat(2, 1fr); }
            .tiles-grid { grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); }
            .controls { flex-direction: column; align-items: stretch; }
            .payment-buttons { grid-template-columns: 1fr; }
            .bill-actions { grid-template-columns: 1fr; }
            .version-info { flex-direction: column; gap: 0.5rem; }
            .type-buttons { grid-template-columns: 1fr; }
            .bulk-import-actions { flex-direction: column; align-items: stretch; }
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.8) translateY(-50px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--white);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.3s ease;
        }

        .notification.error {
            background: linear-gradient(135deg, var(--danger), #dc2626);
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <div class="logo-icon"></div>
                <div class="logo-text">Thynk POS</div>
            </div>
            <div>
                <button class="btn btn-warning" onclick="showSubscriptionTab()">
                    <span class="material-icons-outlined">star</span>
                    Premium
                </button>
            </div>
        </nav>
    </header>

    <!-- Main App -->
    <main class="app">
        <div class="container">
            <div class="app-container">
                <!-- App Header -->
                <div class="app-header">
                    <div class="app-title">Thynk POS - Complete Hotel Management</div>
                    <div class="app-subtitle">All-in-One Control for Hotels That Don't Compromise.</div>
                </div>

                <!-- Statistics -->
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">table_restaurant</span>
                        </div>
                        <div class="stat-value" id="totalTables">0</div>
                        <div class="stat-label">Total Tables/Rooms</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">receipt_long</span>
                        </div>
                        <div class="stat-value" id="billCount">0</div>
                        <div class="stat-label">Bills Generated</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">people</span>
                        </div>
                        <div class="stat-value" id="customerCount">0</div>
                        <div class="stat-label">Customers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <span class="material-icons-outlined">restaurant_menu</span>
                        </div>
                        <div class="stat-value" id="menuCount">0</div>
                        <div class="stat-label">Menu Items</div>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('tables')">
                        <span class="material-icons-outlined">table_restaurant</span>
                        Table/Room Management
                    </button>
                    <button class="tab" onclick="switchTab('menu')">
                        <span class="material-icons-outlined">restaurant_menu</span>
                        Menu Management
                    </button>
                    <button class="tab" onclick="switchTab('billing')">
                        <span class="material-icons-outlined">receipt_long</span>
                        Billing Software
                    </button>
                    <button class="tab" onclick="switchTab('customers')">
                        <span class="material-icons-outlined">people</span>
                        Customer Management
                    </button>
                    <button class="tab" onclick="switchTab('history')">
                        <span class="material-icons-outlined">history</span>
                        History & Reports
                    </button>
                    <button class="tab" onclick="switchTab('subscription')">
                        <span class="material-icons-outlined">star</span>
                        Premium Subscription
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Table/Room Management Tab -->
                    <div class="tab-pane active" id="tables-tab">
                        <div class="controls">
                            <h2>Interactive Table & Room Management</h2>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <div class="tile-counter">
                                    <span id="tableCount">0</span> / 500 Maximum
                                </div>
                                <button class="btn btn-primary" onclick="addNewTable()">
                                    <span class="material-icons-outlined">add</span>
                                    Add Table/Room
                                </button>
                            </div>
                        </div>

                        <!-- Searchable Table/Room Filter -->
                        <div class="search-filter">
                            <input type="text" class="search-input" id="tableSearchInput" placeholder="🔍 Search tables/rooms by number, type, status, or customer name..." onkeyup="filterTables()">
                        </div>

                        <!-- Enhanced Table Tiles Grid with Search Filter -->
                        <div id="tilesGrid" class="tiles-grid">
                            <div class="empty-state">
                                <div class="empty-icon">🏨</div>
                                <h3>No Tables/Rooms Added Yet</h3>
                                <p>Click "Add Table/Room" to create interactive tiles</p>
                                <button class="btn btn-primary" onclick="addNewTable()" style="margin-top: 1rem;">
                                    🏨 Add Your First Table/Room
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Menu Management Tab -->
                    <div class="tab-pane" id="menu-tab">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>Menu Management</h2>
                            <button class="btn btn-primary" onclick="showAddMenuForm()">
                                <span class="material-icons-outlined">add</span>
                                Add Menu Item
                            </button>
                        </div>

                        <!-- Bulk Import Section for Menu -->
                        <div class="bulk-import-section">
                            <div class="bulk-import-header">
                                <h3>📥 Bulk Import Menu Items</h3>
                                <div class="bulk-import-actions">
                                    <button class="btn" onclick="downloadMenuTemplate()" style="background: var(--white); color: var(--info);">
                                        <span class="material-icons-outlined">download</span>
                                        Download Template
                                    </button>
                                    <label for="menuFileInput" class="file-input-label">
                                        <span class="material-icons-outlined">upload_file</span>
                                        Import Excel File
                                    </label>
                                    <input type="file" id="menuFileInput" class="file-input" accept=".xlsx,.xls,.csv" onchange="importMenuFromExcel(event)">
                                </div>
                            </div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Download the template, fill it with your menu items, and upload to add multiple items at once!</p>
                        </div>

                        <!-- Add Menu Form -->
                        <div class="form-section" id="menuForm" style="display: none;">
                            <h3 style="margin-bottom: 1.5rem;">Add New Menu Item</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Item Name *</label>
                                    <input type="text" class="form-input" id="menuItemName" placeholder="e.g., Butter Chicken">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Price (₹) *</label>
                                    <input type="number" class="form-input" id="menuItemPrice" placeholder="320">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Category *</label>
                                    <select class="form-input" id="menuItemCategory">
                                        <option value="">Select Category</option>
                                        <option value="Starters">🥗 Starters</option>
                                        <option value="Main Course">🍛 Main Course</option>
                                        <option value="Dal">🍲 Dal</option>
                                        <option value="Rice">🍚 Rice</option>
                                        <option value="Bread">🍞 Bread</option>
                                        <option value="Beverages">🥤 Beverages</option>
                                        <option value="Desserts">🍰 Desserts</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-input" id="menuItemDescription" rows="3" placeholder="Describe your delicious dish..."></textarea>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-success" onclick="saveMenuItem()">
                                    <span class="material-icons-outlined">save</span>
                                    Save Menu Item
                                </button>
                                <button class="btn btn-danger" onclick="hideMenuForm()">
                                    <span class="material-icons-outlined">close</span>
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Menu Items Display -->
                        <div id="menuItems" class="card-grid">
                            <div class="empty-state">
                                <div class="empty-icon">🍽️</div>
                                <h3>No Menu Items Yet</h3>
                                <p>Add menu items for your restaurant or use bulk import</p>
                            </div>
                        </div>
                    </div>

                    <!-- Enhanced Billing Software Tab -->
                    <div class="tab-pane" id="billing-tab">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>Enhanced Billing Software</h2>
                            <button class="btn btn-primary" onclick="showNewBillForm()">
                                <span class="material-icons-outlined">add</span>
                                Add Items to Order
                            </button>
                        </div>

                        <!-- Check-in Alert for Rooms -->
                        <div class="checkin-alert" id="checkinAlert" style="display: none;">
                            <h3>Room Check-in Required</h3>
                            <p>Please check-in to the selected room.</p>
                            <button class="btn" onclick="performRoomCheckin()" style="background: var(--white); color: var(--info); margin-top: 1rem;">
                                <span class="material-icons-outlined">login</span>
                                Check-in to Room
                            </button>
                        </div>

                        <!-- Simplified Billing Form -->
                        <div class="form-section" id="billForm" style="display: none;">
                            <h3 style="margin-bottom: 1.5rem;">Add Items to Order</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Table/Room FIRST *</label>
                                    <select class="form-input" id="billTableSelect" onchange="loadCustomerForTable()">
                                        <option value="">Select Table/Room</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Customer Name</label>
                                    <div class="customer-search-container">
                                        <input type="text" class="customer-search" id="customerSearchInput" placeholder="Type customer name to search..." autocomplete="off">
                                        <div class="customer-suggestions" id="customerSuggestions"></div>
                                    </div>
                                    <input type="hidden" id="selectedCustomerId">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Menu Item *</label>
                                    <select class="form-input" id="billMenuSelect">
                                        <option value="">Select Menu Item</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Quantity *</label>
                                    <input type="number" class="form-input" id="billQuantity" placeholder="Quantity" min="1" value="1">
                                </div>
                            </div>
                            <div style="display: flex; gap: 1rem;" id="simplifiedActions">
                                <button class="btn btn-success" onclick="addItemToTableOrder()">
                                    <span class="material-icons-outlined">add_shopping_cart</span>
                                    Add Item
                                </button>
                                <button class="btn btn-danger" onclick="hideBillForm()">
                                    <span class="material-icons-outlined">close</span>
                                    Close
                                </button>
                            </div>
                            <div style="display: none; gap: 1rem; margin-top: 1rem;" id="expandedActions">
                                <button class="btn btn-primary" onclick="generateBillFromForm()">
                                    <span class="material-icons-outlined">receipt</span>
                                    Generate Bill
                                </button>
                                <button class="btn btn-warning" onclick="deleteOrderWithoutBill()">
                                    <span class="material-icons-outlined">cancel</span>
                                    Cancel Order
                                </button>
                            </div>
                        </div>

                        <!-- Active Orders Display -->
                        <div id="activeOrders" class="card-grid">
                            <div class="empty-state">
                                <div class="empty-icon">🛒</div>
                                <h3>No Active Orders</h3>
                                <p>Add items to tables to see active orders here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Management Tab -->
                    <div class="tab-pane" id="customers-tab">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>Customer Management Software</h2>
                            <button class="btn btn-primary" onclick="showAddCustomerForm()">
                                <span class="material-icons-outlined">person_add</span>
                                Add New Customer
                            </button>
                        </div>

                        <!-- Bulk Import Section for Customers -->
                        <div class="bulk-import-section">
                            <div class="bulk-import-header">
                                <h3>📥 Bulk Import Customers</h3>
                                <div class="bulk-import-actions">
                                    <button class="btn" onclick="downloadCustomerTemplate()" style="background: var(--white); color: var(--info);">
                                        <span class="material-icons-outlined">download</span>
                                        Download Template
                                    </button>
                                    <label for="customerFileInput" class="file-input-label">
                                        <span class="material-icons-outlined">upload_file</span>
                                        Import Excel File
                                    </label>
                                    <input type="file" id="customerFileInput" class="file-input" accept=".xlsx,.xls,.csv" onchange="importCustomersFromExcel(event)">
                                </div>
                            </div>
                            <p style="opacity: 0.9; font-size: 0.9rem;">Download the template, fill it with customer details, and upload to add multiple customers at once!</p>
                        </div>

                        <!-- Add/Edit Customer Form -->
                        <div class="form-section" id="customerForm" style="display: none;">
                            <h3 style="margin-bottom: 1.5rem;" id="customerFormTitle">Add New Customer</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Customer Name *</label>
                                    <input type="text" class="form-input" id="customerName" placeholder="Enter customer name">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Phone Number *</label>
                                    <input type="tel" class="form-input" id="customerPhone" placeholder="Enter phone number">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email Address</label>
                                    <input type="email" class="form-input" id="customerEmail" placeholder="Enter email address">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Address</label>
                                    <input type="text" class="form-input" id="customerAddress" placeholder="Enter address">
                                </div>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-success" onclick="saveCustomer()">
                                    <span class="material-icons-outlined">save</span>
                                    Save Customer
                                </button>
                                <button class="btn btn-danger" onclick="hideCustomerForm()">
                                    <span class="material-icons-outlined">close</span>
                                    Cancel
                                </button>
                            </div>
                        </div>

                        <!-- Customers List -->
                        <div id="customersList" class="card-grid">
                            <div class="empty-state">
                                <div class="empty-icon">👥</div>
                                <h3>No Customers Added Yet</h3>
                                <p>Add customers manually or use bulk import</p>
                            </div>
                        </div>
                    </div>

                    <!-- History & Reports Tab -->
                    <div class="tab-pane" id="history-tab">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <h2>History & Reports</h2>
                            <button class="btn btn-primary" onclick="clearAllHistory()">
                                <span class="material-icons-outlined">clear_all</span>
                                Clear History
                            </button>
                        </div>

                        <!-- History Timeline -->
                        <div class="history-timeline" id="historyTimeline">
                            <div class="empty-state">
                                <div class="empty-icon">📊</div>
                                <h3>No History Yet</h3>
                                <p>Activity history will appear here</p>
                            </div>
                        </div>
                    </div>

                    <!-- Premium Subscription Tab -->
                    <div class="tab-pane" id="subscription-tab">
                        <div class="payment-container">
                            <h2 style="text-align: center; margin-bottom: 2rem;">Premium Subscription</h2>
                            
                            <!-- Price Display -->
                            <div class="price-display">
                                <div class="original-price" id="originalPrice" style="display: none;">₹999</div>
                                <div class="final-price" id="finalPrice">₹999</div>
                                <div class="discount-badge" id="discountBadge" style="display: none;">Save ₹500!</div>
                                <p style="margin-top: 1rem; color: var(--text-light);">Lifetime Access • No Monthly Fees • 500 Tables/Rooms</p>
                            </div>

                            <!-- Promo Code Section -->
                            <div style="margin-bottom: 2rem;">
                                <div class="form-group">
                                    <label class="form-label">Promo Code (Optional)</label>
                                    <div style="display: flex; gap: 1rem;">
                                        <input type="text" class="form-input" id="promoCode" placeholder="Enter THP25 for ₹500 discount" style="flex: 1;">
                                        <button class="btn btn-primary" onclick="applyPromoCode()">
                                            <span class="material-icons-outlined">local_offer</span>
                                            Apply
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Enhanced Payment Buttons -->
                            <div class="payment-buttons">
                                <button class="payment-btn gpay-btn" onclick="redirectToGooglePay()">
                                    <span>💳</span>
                                    Pay with Google Pay
                                </button>
                                <button class="payment-btn upi-btn" onclick="redirectToUPI()">
                                    <span>📱</span>
                                    Pay with UPI Apps
                                </button>
                                <button class="btn btn-info" onclick="generatePaymentQR()" style="width: 100%;">
                                    <span class="material-icons-outlined">qr_code</span>
                                    Generate QR Code
                                </button>
                            </div>

                            <!-- QR Code Display -->
                            <div class="qr-container" id="qrContainer" style="display: none;">
                                <h3>Scan QR Code to Pay</h3>
                                <img class="qr-code" id="qrCodeImage" alt="UPI Payment QR Code">
                                <p style="color: var(--text-light); margin-bottom: 1rem;">
                                    Scan with any UPI app (Google Pay, PhonePe, Paytm, etc.)
                                </p>
                                <p style="font-weight: 600; color: var(--primary);">
                                    Payment Amount: <span id="qrAmount">₹999</span>
                                </p>
                                <p style="font-size: 0.9rem; color: var(--text-light); margin-top: 1rem;">
                                    Payment to: anaslila@icici
                                </p>
                            </div>

                            <!-- Features List -->
                            <div style="margin-top: 2rem;">
                                <h3 style="margin-bottom: 1rem;">What You Get:</h3>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span class="material-icons-outlined" style="color: var(--success);">check_circle</span>
                                        Searchable Tables/Rooms with Instant Filtering
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span class="material-icons-outlined" style="color: var(--success);">check_circle</span>
                                        Bulk Excel Import for Menu & Customers
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span class="material-icons-outlined" style="color: var(--success);">check_circle</span>
                                        Simplified Billing Flow with Smart Controls
                                    </li>
                                    <li style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <span class="material-icons-outlined" style="color: var(--success);">check_circle</span>
                                        Complete Offline Support with Advanced Features
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer with Version Info -->
    <footer class="footer">
        <div class="version-info">
            <span class="version-badge">v1.5</span>
            <span class="creator-text">Created by Anas Lila</span>
        </div>
    </footer>

    <!-- Enhanced Add/Edit Table Modal -->
    <div class="modal" id="tableModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Add New Table/Room</h3>
            </div>
            
            <!-- Type Selection First -->
            <div class="type-selector" id="typeSelector">
                <h3>First, Select Type</h3>
                <div class="type-buttons">
                    <button class="type-btn" id="tableTypeBtn" onclick="selectTableType('Table')">
                        <span class="material-icons-outlined">table_restaurant</span>
                        Table
                    </button>
                    <button class="type-btn" id="roomTypeBtn" onclick="selectTableType('Room')">
                        <span class="material-icons-outlined">hotel</span>
                        Room
                    </button>
                </div>
            </div>

            <div class="form-section" id="tableFormSection" style="display: none;">
                <div class="form-grid" id="tableFormGrid">
                    <div class="form-group">
                        <label class="form-label">Number *</label>
                        <input type="number" class="form-input big" id="tableNumber" placeholder="Enter Number" min="1">
                    </div>
                    <div class="form-group" id="chairsGroup">
                        <label class="form-label">Number of Chairs *</label>
                        <input type="number" class="form-input big" id="tableChairs" placeholder="Number of chairs" min="1" max="20" value="4">
                    </div>
                    <div class="form-group" id="priceGroup" style="display: none;">
                        <label class="form-label">Price per Night (₹) *</label>
                        <input type="number" class="form-input big" id="roomPrice" placeholder="Room price per night" min="0">
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                    <button class="btn btn-success" onclick="saveTable()">
                        <span class="material-icons-outlined">save</span>
                        Save
                    </button>
                    <button class="btn btn-warning" onclick="goBackToTypeSelection()">
                        <span class="material-icons-outlined">arrow_back</span>
                        Back to Type
                    </button>
                    <button class="btn btn-danger" onclick="closeTableModal()">
                        <span class="material-icons-outlined">close</span>
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Bill Display Modal -->
    <div class="modal" id="billModal">
        <div class="modal-content">
            <div class="bill-display" id="billDisplay">
                <!-- Bill content will be populated here -->
            </div>
        </div>
    </div>

    <!-- Checkout Bill Sharing Modal -->
    <div class="modal" id="checkoutBillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Room Check-out Complete</h3>
            </div>
            <div id="checkoutBillContent">
                <!-- Checkout bill content will be populated here -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Enhanced Restaurant Database System with History Tracking
        const RestaurantDB = {
            tables: {
                save: (table) => {
                    const tables = JSON.parse(localStorage.getItem('thynk_tables') || '[]');
                    if (tables.length >= 500) {
                        showNotification('Maximum 500 tables/rooms allowed!', 'error');
                        return false;
                    }
                    const newTable = {
                        id: Date.now(),
                        number: table.number,
                        type: table.type,
                        chairs: table.chairs || 0,
                        price: table.price || 0,
                        status: 'available',
                        checkedIn: false,
                        checkInDate: null,
                        checkOutDate: null,
                        order: {
                            customerId: null,
                            customerName: '',
                            items: [],
                            total: 0
                        },
                        created: new Date().toISOString()
                    };
                    tables.push(newTable);
                    localStorage.setItem('thynk_tables', JSON.stringify(tables));
                    
                    // Add to history
                    RestaurantDB.history.add({
                        type: 'table_created',
                        title: `${table.type} ${table.number} Created`,
                        details: `New ${table.type.toLowerCase()} added with ${table.type === 'Room' ? `₹${table.price}/night` : `${table.chairs} chairs`}`,
                        icon: table.type === 'Room' ? 'hotel' : 'table_restaurant'
                    });
                    
                    return tables.length;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_tables') || '[]'),
                getAvailable: () => {
                    const tables = RestaurantDB.tables.getAll();
                    return tables.filter(table => table.status === 'available');
                },
                update: (id, updates) => {
                    const tables = RestaurantDB.tables.getAll();
                    const index = tables.findIndex(table => table.id === parseInt(id));
                    if (index !== -1) {
                        tables[index] = {...tables[index], ...updates};
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        return true;
                    }
                    return false;
                },
                delete: (id) => {
                    const tables = RestaurantDB.tables.getAll();
                    const table = tables.find(t => t.id === parseInt(id));
                    const remainingTables = tables.filter(table => table.id !== parseInt(id));
                    localStorage.setItem('thynk_tables', JSON.stringify(remainingTables));
                    
                    // Add to history
                    if (table) {
                        RestaurantDB.history.add({
                            type: 'table_deleted',
                            title: `${table.type} ${table.number} Deleted`,
                            details: `${table.type} removed from system`,
                            icon: 'delete'
                        });
                    }
                },
                checkIn: (id, customerInfo) => {
                    const tables = RestaurantDB.tables.getAll();
                    const index = tables.findIndex(table => table.id === parseInt(id));
                    if (index !== -1 && tables[index].type === 'Room') {
                        tables[index].checkedIn = true;
                        tables[index].status = 'occupied';
                        tables[index].checkInDate = new Date().toISOString();
                        tables[index].order.customerId = customerInfo.customerId;
                        tables[index].order.customerName = customerInfo.customerName;
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        
                        // Add to history
                        RestaurantDB.history.add({
                            type: 'room_checkin',
                            title: `Room ${tables[index].number} Check-in`,
                            details: `${customerInfo.customerName} checked into room ${tables[index].number}`,
                            icon: 'login',
                            customerName: customerInfo.customerName
                        });
                        
                        return true;
                    }
                    return false;
                },
                checkOut: (id, generateBill = false) => {
                    const tables = RestaurantDB.tables.getAll();
                    const index = tables.findIndex(table => table.id === parseInt(id));
                    if (index !== -1 && tables[index].type === 'Room') {
                        const table = tables[index];
                        const customerName = table.order.customerName;
                        let bill = null;
                        
                        // Generate bill if items exist or requested
                        if (generateBill || table.order.items.length > 0) {
                            let finalTotal = table.order.total;
                            let roomCharge = 0;
                            
                            if (table.type === 'Room' && table.price > 0) {
                                roomCharge = table.price;
                                finalTotal += roomCharge;
                            }
                            
                            bill = RestaurantDB.bills.save({
                                tableId: table.id,
                                tableNumber: `${table.type} ${table.number}`,
                                customerId: table.order.customerId,
                                customerName: table.order.customerName,
                                customerPhone: getCustomerPhone(table.order.customerId),
                                customerEmail: getCustomerEmail(table.order.customerId),
                                items: table.order.items,
                                roomCharge: roomCharge,
                                itemsTotal: table.order.total,
                                total: finalTotal
                            });
                            
                            // Update customer spending
                            if (table.order.customerId) {
                                RestaurantDB.customers.updateSpent(table.order.customerId, finalTotal);
                            }
                        }
                        
                        tables[index].checkedIn = false;
                        tables[index].status = 'available';
                        tables[index].checkOutDate = new Date().toISOString();
                        tables[index].order = {
                            customerId: null,
                            customerName: '',
                            items: [],
                            total: 0
                        };
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        
                        // Add to history
                        RestaurantDB.history.add({
                            type: 'room_checkout',
                            title: `Room ${table.number} Check-out`,
                            details: `${customerName} checked out from room ${table.number}${bill ? ' with bill generated' : ''}`,
                            icon: 'logout',
                            customerName: customerName
                        });
                        
                        return { success: true, bill: bill, table: table };
                    }
                    return { success: false };
                },
                cancelCheckin: (id) => {
                    const tables = RestaurantDB.tables.getAll();
                    const index = tables.findIndex(table => table.id === parseInt(id));
                    if (index !== -1 && tables[index].type === 'Room' && tables[index].checkedIn) {
                        const table = tables[index];
                        const customerName = table.order.customerName;
                        
                        tables[index].checkedIn = false;
                        tables[index].status = 'available';
                        tables[index].checkOutDate = new Date().toISOString();
                        tables[index].order = {
                            customerId: null,
                            customerName: '',
                            items: [],
                            total: 0
                        };
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        
                        // Add to history
                        RestaurantDB.history.add({
                            type: 'checkin_cancelled',
                            title: `Room ${table.number} Check-in Cancelled`,
                            details: `${customerName} cancelled check-in for room ${table.number}`,
                            icon: 'cancel',
                            customerName: customerName
                        });
                        
                        return true;
                    }
                    return false;
                },
                addItemToOrder: (tableId, item, customerInfo) => {
                    const tables = RestaurantDB.tables.getAll();
                    const tableIndex = tables.findIndex(t => t.id === parseInt(tableId));
                    if (tableIndex !== -1) {
                        const table = tables[tableIndex];
                        
                        // For rooms, check if checked in
                        if (table.type === 'Room' && !table.checkedIn) {
                            return false;
                        }
                        
                        const existingItemIndex = table.order.items.findIndex(i => i.menuId === item.menuId);
                        if (existingItemIndex !== -1) {
                            table.order.items[existingItemIndex].quantity += item.quantity;
                            table.order.items[existingItemIndex].total = 
                                table.order.items[existingItemIndex].quantity * 
                                table.order.items[existingItemIndex].price;
                        } else {
                            table.order.items.push({
                                id: Date.now(),
                                menuId: item.menuId,
                                name: item.name,
                                price: item.price,
                                quantity: item.quantity,
                                total: item.price * item.quantity
                            });
                        }
                        
                        table.status = 'occupied';
                        table.order.customerId = customerInfo.customerId;
                        table.order.customerName = customerInfo.customerName;
                        table.order.total = table.order.items.reduce((sum, i) => sum + i.total, 0);
                        
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        
                        // Add to history
                        RestaurantDB.history.add({
                            type: 'item_added',
                            title: `${item.quantity}x ${item.name} Added`,
                            details: `Added to ${table.type} ${table.number} for ${customerInfo.customerName}`,
                            icon: 'restaurant_menu',
                            customerName: customerInfo.customerName
                        });
                        
                        return true;
                    }
                    return false;
                },
                clearOrder: (tableId, isCancellation = false) => {
                    const tables = RestaurantDB.tables.getAll();
                    const tableIndex = tables.findIndex(t => t.id === parseInt(tableId));
                    if (tableIndex !== -1) {
                        const table = tables[tableIndex];
                        const customerName = table.order.customerName;
                        const itemCount = table.order.items.length;
                        
                        // Don't add cancelled orders to history
                        if (!isCancellation && itemCount > 0) {
                            RestaurantDB.history.add({
                                type: 'order_cleared',
                                title: `Order Cleared - ${table.type} ${table.number}`,
                                details: `${itemCount} items cleared for ${customerName}`,
                                icon: 'clear',
                                customerName: customerName
                            });
                        }
                        
                        // For rooms, only clear order if checked out
                        if (table.type === 'Room') {
                            table.order = {
                                customerId: table.order.customerId,
                                customerName: table.order.customerName,
                                items: [],
                                total: 0
                            };
                        } else {
                            // For tables, clear everything
                            table.status = 'available';
                            table.order = {
                                customerId: null,
                                customerName: '',
                                items: [],
                                total: 0
                            };
                        }
                        
                        localStorage.setItem('thynk_tables', JSON.stringify(tables));
                        return true;
                    }
                    return false;
                }
            },
            menu: {
                save: (item) => {
                    const menu = JSON.parse(localStorage.getItem('thynk_menu') || '[]');
                    const newItem = {
                        id: Date.now(),
                        name: item.name,
                        price: parseFloat(item.price),
                        category: item.category,
                        description: item.description || '',
                        created: new Date().toISOString()
                    };
                    menu.push(newItem);
                    localStorage.setItem('thynk_menu', JSON.stringify(menu));
                    
                    // Add to history
                    RestaurantDB.history.add({
                        type: 'menu_added',
                        title: `Menu Item "${item.name}" Added`,
                        details: `${item.category} - ₹${item.price}`,
                        icon: 'restaurant_menu'
                    });
                    
                    return menu.length;
                },
                bulkSave: (items) => {
                    const menu = JSON.parse(localStorage.getItem('thynk_menu') || '[]');
                    let addedCount = 0;
                    
                    items.forEach(item => {
                        if (item.name && item.price && item.category) {
                            const newItem = {
                                id: Date.now() + addedCount,
                                name: item.name,
                                price: parseFloat(item.price),
                                category: item.category,
                                description: item.description || '',
                                created: new Date().toISOString()
                            };
                            menu.push(newItem);
                            addedCount++;
                        }
                    });
                    
                    localStorage.setItem('thynk_menu', JSON.stringify(menu));
                    
                    // Add to history
                    if (addedCount > 0) {
                        RestaurantDB.history.add({
                            type: 'menu_bulk_import',
                            title: `${addedCount} Menu Items Imported`,
                            details: `Bulk import from Excel file`,
                            icon: 'upload_file'
                        });
                    }
                    
                    return addedCount;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_menu') || '[]'),
                update: (id, updates) => {
                    const menu = RestaurantDB.menu.getAll();
                    const index = menu.findIndex(item => item.id === parseInt(id));
                    if (index !== -1) {
                        const oldName = menu[index].name;
                        menu[index] = {...menu[index], ...updates};
                        localStorage.setItem('thynk_menu', JSON.stringify(menu));
                        
                        // Add to history
                        RestaurantDB.history.add({
                            type: 'menu_updated',
                            title: `Menu Item "${updates.name || oldName}" Updated`,
                            details: `${updates.category || menu[index].category} - ₹${updates.price || menu[index].price}`,
                            icon: 'edit'
                        });
                        
                        return true;
                    }
                    return false;
                },
                delete: (id) => {
                    const menu = RestaurantDB.menu.getAll();
                    const item = menu.find(m => m.id === parseInt(id));
                    const remainingMenu = menu.filter(item => item.id !== parseInt(id));
                    localStorage.setItem('thynk_menu', JSON.stringify(remainingMenu));
                    
                    // Add to history
                    if (item) {
                        RestaurantDB.history.add({
                            type: 'menu_deleted',
                            title: `Menu Item "${item.name}" Deleted`,
                            details: `Removed from ${item.category}`,
                            icon: 'delete'
                        });
                    }
                }
            },
            customers: {
                save: (customer) => {
                    const customers = JSON.parse(localStorage.getItem('thynk_customers') || '[]');
                    const newCustomer = {
                        id: Date.now(),
                        name: customer.name,
                        phone: customer.phone,
                        email: customer.email || '',
                        address: customer.address || '',
                        created: new Date().toISOString(),
                        totalOrders: 0,
                        totalSpent: 0
                    };
                    customers.push(newCustomer);
                    localStorage.setItem('thynk_customers', JSON.stringify(customers));
                    
                    // Add to history
                    RestaurantDB.history.add({
                        type: 'customer_added',
                        title: `Customer "${customer.name}" Added`,
                        details: `Phone: ${customer.phone}${customer.email ? `, Email: ${customer.email}` : ''}`,
                        icon: 'person_add',
                        customerName: customer.name
                    });
                    
                    return customers.length;
                },
                bulkSave: (customers) => {
                    const existingCustomers = JSON.parse(localStorage.getItem('thynk_customers') || '[]');
                    let addedCount = 0;
                    
                    customers.forEach(customer => {
                        if (customer.name && customer.phone) {
                            const newCustomer = {
                                id: Date.now() + addedCount,
                                name: customer.name,
                                phone: customer.phone,
                                email: customer.email || '',
                                address: customer.address || '',
                                created: new Date().toISOString(),
                                totalOrders: 0,
                                totalSpent: 0
                            };
                            existingCustomers.push(newCustomer);
                            addedCount++;
                        }
                    });
                    
                    localStorage.setItem('thynk_customers', JSON.stringify(existingCustomers));
                    
                    // Add to history
                    if (addedCount > 0) {
                        RestaurantDB.history.add({
                            type: 'customer_bulk_import',
                            title: `${addedCount} Customers Imported`,
                            details: `Bulk import from Excel file`,
                            icon: 'upload_file'
                        });
                    }
                    
                    return addedCount;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_customers') || '[]'),
                search: (query) => {
                    const customers = RestaurantDB.customers.getAll();
                    if (!query.trim()) return [];
                    
                    const lowerQuery = query.toLowerCase();
                    return customers.filter(customer => 
                        customer.name.toLowerCase().includes(lowerQuery) ||
                        customer.phone.includes(query) ||
                        customer.email.toLowerCase().includes(lowerQuery)
                    ).slice(0, 5); // Limit to 5 suggestions
                },
                update: (id, updates) => {
                    const customers = RestaurantDB.customers.getAll();
                    const index = customers.findIndex(customer => customer.id === parseInt(id));
                    if (index !== -1) {
                        customers[index] = {...customers[index], ...updates};
                        localStorage.setItem('thynk_customers', JSON.stringify(customers));
                        return true;
                    }
                    return false;
                },
                updateSpent: (customerId, amount) => {
                    const customers = RestaurantDB.customers.getAll();
                    const customerIndex = customers.findIndex(c => c.id === parseInt(customerId));
                    if (customerIndex !== -1) {
                        customers[customerIndex].totalOrders += 1;
                        customers[customerIndex].totalSpent += amount;
                        localStorage.setItem('thynk_customers', JSON.stringify(customers));
                    }
                }
            },
            bills: {
                save: (bill) => {
                    const bills = JSON.parse(localStorage.getItem('thynk_bills') || '[]');
                    const newBill = {
                        id: Date.now(),
                        ...bill,
                        date: new Date().toISOString()
                    };
                    bills.push(newBill);
                    localStorage.setItem('thynk_bills', JSON.stringify(bills));
                    
                    // Add to history
                    RestaurantDB.history.add({
                        type: 'bill_generated',
                        title: `Bill Generated - ₹${bill.total.toFixed(2)}`,
                        details: `${bill.tableNumber} for ${bill.customerName} (${bill.items.length} items)`,
                        icon: 'receipt',
                        customerName: bill.customerName
                    });
                    
                    return newBill;
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_bills') || '[]'),
                delete: (id) => {
                    const bills = RestaurantDB.bills.getAll().filter(bill => bill.id !== parseInt(id));
                    localStorage.setItem('thynk_bills', JSON.stringify(bills));
                    return true;
                }
            },
            history: {
                add: (entry) => {
                    const history = JSON.parse(localStorage.getItem('thynk_history') || '[]');
                    const newEntry = {
                        id: Date.now(),
                        ...entry,
                        timestamp: new Date().toISOString()
                    };
                    history.unshift(newEntry); // Add to beginning
                    
                    // Keep only last 100 entries
                    if (history.length > 100) {
                        history.splice(100);
                    }
                    
                    localStorage.setItem('thynk_history', JSON.stringify(history));
                },
                getAll: () => JSON.parse(localStorage.getItem('thynk_history') || '[]'),
                clear: () => {
                    localStorage.setItem('thynk_history', '[]');
                }
            }
        };

        // Global Variables
        let currentTab = 'tables';
        let editingTableId = null;
        let editingCustomerId = null;
        let selectedTableType = null;
        let currentOrderTableId = null;
        let selectedTableForCheckin = null;
        let discountApplied = false;
        let expandedTileId = null;
        let selectedCustomerData = null;
        let hasItemsInOrder = false;

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
            
            currentTab = tabName;
            
            if (tabName === 'tables') loadTables();
            if (tabName === 'menu') loadMenuItems();
            if (tabName === 'billing') { loadActiveOrders(); loadBillingDropdowns(); }
            if (tabName === 'customers') loadCustomers();
            if (tabName === 'history') loadHistory();
            
            updateStats();
        }

        // Table Search Filter Function
        function filterTables() {
            const searchQuery = document.getElementById('tableSearchInput').value.toLowerCase();
            const tables = RestaurantDB.tables.getAll();
            
            tables.forEach(table => {
                const tile = document.getElementById(`tile-${table.id}`);
                if (tile) {
                    const shouldShow = 
                        table.number.toString().includes(searchQuery) ||
                        table.type.toLowerCase().includes(searchQuery) ||
                        table.status.toLowerCase().includes(searchQuery) ||
                        (table.order.customerName && table.order.customerName.toLowerCase().includes(searchQuery));
                    
                    if (shouldShow) {
                        tile.classList.remove('hidden');
                    } else {
                        tile.classList.add('hidden');
                    }
                }
            });

            // Show/hide empty state based on visible tiles
            const visibleTiles = document.querySelectorAll('.table-tile:not(.hidden)');
            const emptyState = document.querySelector('#tilesGrid .empty-state');
            if (emptyState) {
                emptyState.style.display = visibleTiles.length === 0 ? 'block' : 'none';
            }
        }

        // Enhanced Table Management Functions
        function addNewTable() {
            editingTableId = null;
            selectedTableType = null;
            document.getElementById('modalTitle').textContent = 'Add New Table/Room';
            
            // Show type selector first, hide form
            document.getElementById('typeSelector').style.display = 'block';
            document.getElementById('tableFormSection').style.display = 'none';
            
            // Reset type buttons
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            
            // Clear form values
            document.getElementById('tableNumber').value = '';
            document.getElementById('tableChairs').value = '4';
            document.getElementById('roomPrice').value = '';
            
            document.getElementById('tableModal').classList.add('show');
        }

        function selectTableType(type) {
            selectedTableType = type;
            
            // Update type button states
            document.querySelectorAll('.type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(type.toLowerCase() + 'TypeBtn').classList.add('active');
            
            // Show form section
            document.getElementById('typeSelector').style.display = 'none';
            document.getElementById('tableFormSection').style.display = 'block';
            
            // Make inputs big for new creation
            document.querySelectorAll('#tableFormGrid .form-input').forEach(input => {
                input.className = 'form-input big';
            });
            
            // Show relevant fields
            toggleFieldsForType(type);
            
            // Set placeholder
            const numberInput = document.getElementById('tableNumber');
            numberInput.placeholder = `${type} Number`;
            numberInput.focus();
        }

        function toggleFieldsForType(type) {
            const chairsGroup = document.getElementById('chairsGroup');
            const priceGroup = document.getElementById('priceGroup');
            
            if (type === 'Room') {
                chairsGroup.style.display = 'none';
                priceGroup.style.display = 'block';
            } else {
                chairsGroup.style.display = 'block';
                priceGroup.style.display = 'none';
            }
        }

        function goBackToTypeSelection() {
            document.getElementById('typeSelector').style.display = 'block';
            document.getElementById('tableFormSection').style.display = 'none';
            selectedTableType = null;
        }

        function editTableInTile(id) {
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === id);
            if (!table) return;

            editingTableId = id;
            selectedTableType = table.type;
            document.getElementById('modalTitle').textContent = `Edit ${table.type} ${table.number}`;
            
            // Skip type selection for editing, go straight to form
            document.getElementById('typeSelector').style.display = 'none';
            document.getElementById('tableFormSection').style.display = 'block';
            
            // Make inputs small for editing
            document.querySelectorAll('#tableFormGrid .form-input').forEach(input => {
                input.className = 'form-input small';
            });
            
            // Populate values
            document.getElementById('tableNumber').value = table.number;
            document.getElementById('tableNumber').placeholder = `${table.type} Number`;
            
            if (table.type === 'Room') {
                document.getElementById('roomPrice').value = table.price;
            } else {
                document.getElementById('tableChairs').value = table.chairs;
            }
            
            toggleFieldsForType(table.type);
            document.getElementById('tableModal').classList.add('show');
        }

        function saveTable() {
            if (!selectedTableType) {
                showNotification('Please select table or room type first', 'error');
                return;
            }

            const number = document.getElementById('tableNumber').value.trim();
            const chairs = selectedTableType === 'Table' ? document.getElementById('tableChairs').value.trim() : 0;
            const price = selectedTableType === 'Room' ? document.getElementById('roomPrice').value.trim() : 0;

            if (!number) {
                showNotification(`Please enter ${selectedTableType.toLowerCase()} number`, 'error');
                return;
            }

            if (selectedTableType === 'Table' && !chairs) {
                showNotification('Please enter number of chairs', 'error');
                return;
            }

            if (selectedTableType === 'Room' && !price) {
                showNotification('Please enter room price per night', 'error');
                return;
            }

            if (editingTableId) {
                RestaurantDB.tables.update(editingTableId, { 
                    number: parseInt(number), 
                    type: selectedTableType, 
                    chairs: parseInt(chairs) || 0,
                    price: parseFloat(price) || 0
                });
                showNotification(`${selectedTableType} ${number} updated successfully!`);
            } else {
                const result = RestaurantDB.tables.save({ 
                    number: parseInt(number), 
                    type: selectedTableType, 
                    chairs: parseInt(chairs) || 0,
                    price: parseFloat(price) || 0
                });
                if (result) {
                    showNotification(`${selectedTableType} ${number} added successfully!`);
                }
            }

            closeTableModal();
            loadTables();
            updateStats();
        }

        function closeTableModal() {
            document.getElementById('tableModal').classList.remove('show');
            selectedTableType = null;
            editingTableId = null;
        }

        function deleteTable(id, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === id);
            if (!table) return;

            if (confirm(`Delete ${table.type} ${table.number}? This cannot be undone.`)) {
                RestaurantDB.tables.delete(id);
                showNotification(`${table.type} ${table.number} deleted successfully`);
                loadTables();
                updateStats();
            }
        }

        // Enhanced Table Loading with Search Filter
        function loadTables() {
            const tables = RestaurantDB.tables.getAll();
            const container = document.getElementById('tilesGrid');
            
            if (tables.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🏨</div>
                        <h3>No Tables/Rooms Added Yet</h3>
                        <p>Click "Add Table/Room" to create interactive tiles</p>
                        <button class="btn btn-primary" onclick="addNewTable()" style="margin-top: 1rem;">
                            🏨 Add Your First Table/Room
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = tables.map(table => {
                const isExpanded = expandedTileId === table.id;
                const orderItems = table.order.items || [];
                const customerName = table.order.customerName || 'No customer';
                const typeClass = table.type.toLowerCase();
                const statusClass = table.status;
                
                return `
                    <div class="table-tile ${typeClass} ${statusClass} ${isExpanded ? 'expanded' : ''}" onclick="toggleTileDetails(${table.id})" id="tile-${table.id}">
                        <button class="tile-remove-btn" onclick="deleteTable(${table.id}, event)" title="Remove ${table.type} ${table.number}">
                            <span class="material-icons-outlined" style="font-size: 14px;">close</span>
                        </button>
                        
                        <!-- Always Visible Header -->
                        <div class="tile-header">
                            <div class="tile-number">${table.type === 'Room' ? 'R' : 'T'}${table.number}</div>
                            <div class="tile-info">${table.type} ${table.status === 'available' ? '(Available)' : '(Occupied)'}</div>
                            <div class="tile-price">
                                ${table.type === 'Room' ? 
                                    `₹${table.price}/night` : 
                                    `${table.chairs} ${table.chairs === 1 ? 'Chair' : 'Chairs'}`
                                }
                            </div>
                            ${table.type === 'Room' ? `
                                <div class="checkin-status">
                                    ${table.checkedIn ? '✅ Checked In' : '🔒 Not Checked In'}
                                </div>
                            ` : ''}
                            ${orderItems.length > 0 ? `<div class="tile-price" style="font-weight: 800;">₹${table.order.total.toFixed(2)}</div>` : ''}
                        </div>

                        <!-- Sliding Details Section -->
                        <div class="tile-details ${isExpanded ? 'expanded' : ''}">
                            <div class="details-content">
                                <div class="customer-info">
                                    <strong>Customer:</strong> ${customerName}
                                    ${table.type === 'Room' && table.checkedIn ? `<br><small>Checked in: ${new Date(table.checkInDate).toLocaleString()}</small>` : ''}
                                </div>
                                
                                ${orderItems.length > 0 ? `
                                    <div class="menu-items">
                                        ${orderItems.map(item => `
                                            <div class="menu-item">
                                                <span>${item.name} x${item.quantity}</span>
                                                <span>₹${item.total.toFixed(2)}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : '<div style="text-align: center; color: inherit; opacity: 0.8; margin: 1rem 0;">No items added yet</div>'}
                                
                                <div class="tile-actions">
                                    ${table.type === 'Room' && !table.checkedIn ? `
                                        <button class="btn btn-sm btn-info" onclick="performRoomCheckinFromTile(${table.id}, event)">
                                            <span class="material-icons-outlined">login</span>
                                            Check-in
                                        </button>
                                    ` : `
                                        <button class="btn btn-sm btn-primary" onclick="addItemToTable(${table.id}, event)">
                                            <span class="material-icons-outlined">add</span>
                                            Add Item
                                        </button>
                                    `}
                                    
                                    ${table.type === 'Room' && table.checkedIn ? `
                                        <button class="btn btn-sm btn-warning" onclick="performRoomCheckout(${table.id}, event)">
                                            <span class="material-icons-outlined">logout</span>
                                            Check-out
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="cancelRoomCheckin(${table.id}, event)">
                                            <span class="material-icons-outlined">cancel</span>
                                            Cancel Check-in
                                        </button>
                                    ` : ''}
                                    
                                    <button class="btn btn-sm btn-warning" onclick="editTableInTile(${table.id})" ${!isExpanded ? 'style="display: none;"' : ''}>
                                        <span class="material-icons-outlined">edit</span>
                                        Edit
                                    </button>
                                    
                                    ${orderItems.length > 0 ? `
                                        <button class="btn btn-sm btn-success" onclick="generateBillForTable(${table.id}, event)">
                                            <span class="material-icons-outlined">receipt</span>
                                            Generate Bill
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="cancelOrderFromTile(${table.id}, event)">
                                            <span class="material-icons-outlined">cancel</span>
                                            Cancel Order
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Apply current search filter
            const searchQuery = document.getElementById('tableSearchInput').value;
            if (searchQuery) {
                filterTables();
            }
        }

        function toggleTileDetails(tableId) {
            if (expandedTileId === tableId) {
                expandedTileId = null;
            } else {
                expandedTileId = tableId;
            }
            loadTables();
        }

        // Room Check-in/Check-out Functions
        function performRoomCheckinFromTile(tableId, event) {
            event.stopPropagation();
            selectedTableForCheckin = tableId;
            switchTab('billing');
            setTimeout(() => {
                showNewBillForm();
                document.getElementById('billTableSelect').value = tableId;
                loadCustomerForTable();
            }, 300);
        }

        function performRoomCheckin() {
            const tableId = document.getElementById('billTableSelect').value;
            let customerId = document.getElementById('selectedCustomerId').value;
            let customerName = document.getElementById('customerSearchInput').value.trim();

            if (!customerName) {
                showNotification('Please enter customer name for check-in', 'error');
                return;
            }

            let finalCustomerName = customerName;
            let finalCustomerId = customerId;

            // Add new customer if not found in search
            if (!customerId || customerId === 'new') {
                RestaurantDB.customers.save({ name: customerName, phone: '', email: '', address: '' });
                const customers = RestaurantDB.customers.getAll();
                const newCustomer = customers[customers.length - 1];
                finalCustomerId = newCustomer.id;
                finalCustomerName = customerName;
            }

            // Perform check-in
            const success = RestaurantDB.tables.checkIn(tableId, {
                customerId: finalCustomerId,
                customerName: finalCustomerName
            });

            if (success) {
                showNotification(`Room checked-in successfully for ${finalCustomerName}!`);
                document.getElementById('checkinAlert').style.display = 'none';
                loadTables();
                loadActiveOrders();
                updateStats();
            } else {
                showNotification('Failed to check-in room', 'error');
            }
        }

        function performRoomCheckout(tableId, event) {
            event.stopPropagation();
            
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === tableId);
            
            if (!table) return;

            let generateBill = false;
            if (table.order.items.length > 0) {
                generateBill = confirm(`Room ${table.number} has ${table.order.items.length} pending items. Generate bill before checkout?`);
            }

            const result = RestaurantDB.tables.checkOut(tableId, generateBill);
            
            if (result.success) {
                showNotification(`Room ${table.number} checked-out successfully!`);
                
                // Show checkout bill sharing if bill was generated
                if (result.bill) {
                    displayCheckoutBill(result.bill, result.table);
                }
                
                loadTables();
                loadActiveOrders();
                updateStats();
            } else {
                showNotification('Failed to check-out room', 'error');
            }
        }

        function cancelRoomCheckin(tableId, event) {
            event.stopPropagation();
            
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === tableId);
            
            if (!table) return;

            if (table.order.items.length > 0) {
                if (!confirm(`Room ${table.number} has pending orders. Cancelling check-in will remove all items. Continue?`)) {
                    return;
                }
            }

            const success = RestaurantDB.tables.cancelCheckin(tableId);
            
            if (success) {
                showNotification(`Room ${table.number} check-in cancelled successfully!`);
                loadTables();
                loadActiveOrders();
                updateStats();
            } else {
                showNotification('Failed to cancel check-in', 'error');
            }
        }

        function addItemToTable(tableId, event) {
            event.stopPropagation();
            switchTab('billing');
            setTimeout(() => {
                showNewBillForm();
                document.getElementById('billTableSelect').value = tableId;
                loadCustomerForTable();
            }, 300);
        }

        function generateBillForTable(tableId, event) {
            event.stopPropagation();
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === tableId);
            
            if (!table || table.order.items.length === 0) {
                showNotification('No items in order to bill', 'error');
                return;
            }

            generateBillFromTableData(table);
        }

        function cancelOrderFromTile(tableId, event) {
            event.stopPropagation();
            
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === tableId);
            
            if (!table) return;

            if (confirm(`Cancel order for ${table.type} ${table.number}? All items will be removed.`)) {
                RestaurantDB.tables.clearOrder(tableId, true); // true = is cancellation
                showNotification('Order cancelled successfully!');
                loadTables();
                loadActiveOrders();
                updateStats();
            }
        }

        // Enhanced Billing Software Functions - Simplified Form
        function showNewBillForm() {
            document.getElementById('billForm').style.display = 'block';
            document.getElementById('checkinAlert').style.display = 'none';
            hasItemsInOrder = false;
            toggleBillFormActions();
            loadBillingDropdowns();
            setupCustomerSearch();
        }

        function hideBillForm() {
            document.getElementById('billForm').style.display = 'none';
            document.getElementById('checkinAlert').style.display = 'none';
            clearBillForm();
        }

        function clearBillForm() {
            document.getElementById('billTableSelect').value = '';
            document.getElementById('customerSearchInput').value = '';
            document.getElementById('selectedCustomerId').value = '';
            document.getElementById('billMenuSelect').value = '';
            document.getElementById('billQuantity').value = '1';
            document.getElementById('customerSuggestions').style.display = 'none';
            selectedCustomerData = null;
            hasItemsInOrder = false;
            toggleBillFormActions();
        }

        function toggleBillFormActions() {
            const simplifiedActions = document.getElementById('simplifiedActions');
            const expandedActions = document.getElementById('expandedActions');
            
            if (hasItemsInOrder) {
                simplifiedActions.style.display = 'none';
                expandedActions.style.display = 'flex';
            } else {
                simplifiedActions.style.display = 'flex';
                expandedActions.style.display = 'none';
            }
        }

        function loadBillingDropdowns() {
            loadTableDropdownForBilling();
            loadMenuDropdown();
        }

        function loadTableDropdownForBilling() {
            const tables = RestaurantDB.tables.getAll();
            const select = document.getElementById('billTableSelect');
            
            select.innerHTML = '<option value="">Select Table/Room FIRST</option>';
            tables.forEach(table => {
                const statusText = table.status === 'occupied' ? ' (OCCUPIED)' : ' (AVAILABLE)';
                const checkinText = table.type === 'Room' ? (table.checkedIn ? ' - CHECKED IN' : ' - NOT CHECKED IN') : '';
                const itemCount = table.order.items.length > 0 ? ` - ${table.order.items.length} items` : '';
                select.innerHTML += `<option value="${table.id}">${table.type} ${table.number}${statusText}${checkinText}${itemCount}</option>`;
            });
        }

        // Enhanced Customer Search System
        function setupCustomerSearch() {
            const searchInput = document.getElementById('customerSearchInput');
            const suggestionsDiv = document.getElementById('customerSuggestions');
            const selectedCustomerIdInput = document.getElementById('selectedCustomerId');

            searchInput.addEventListener('input', function() {
                const query = this.value.trim();
                
                if (query.length < 2) {
                    suggestionsDiv.style.display = 'none';
                    selectedCustomerIdInput.value = '';
                    selectedCustomerData = null;
                    return;
                }

                const customers = RestaurantDB.customers.search(query);
                
                if (customers.length > 0) {
                    suggestionsDiv.innerHTML = customers.map(customer => {
                        let contactInfo = '';
                        if (customer.phone) {
                            contactInfo = customer.phone;
                        } else if (customer.email) {
                            contactInfo = customer.email;
                        } else if (customer.address) {
                            contactInfo = customer.address;
                        }

                        return `
                            <div class="customer-suggestion" onclick="selectCustomer(${customer.id}, '${customer.name.replace(/'/g, "\\'")}', '${contactInfo}')">
                                <div class="suggestion-name">${customer.name}</div>
                                ${contactInfo ? `<div class="suggestion-contact">${contactInfo}</div>` : ''}
                            </div>
                        `;
                    }).join('');
                    suggestionsDiv.style.display = 'block';
                } else {
                    suggestionsDiv.innerHTML = `
                        <div class="customer-suggestion" onclick="selectNewCustomer('${query}')">
                            <div class="suggestion-name">+ Add "${query}" as new customer</div>
                            <div class="suggestion-contact">Click to add to customer database</div>
                        </div>
                    `;
                    suggestionsDiv.style.display = 'block';
                }
            });

            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !suggestionsDiv.contains(e.target)) {
                    suggestionsDiv.style.display = 'none';
                }
            });
        }

        function selectCustomer(customerId, customerName, contactInfo) {
            document.getElementById('customerSearchInput').value = customerName;
            document.getElementById('selectedCustomerId').value = customerId;
            document.getElementById('customerSuggestions').style.display = 'none';
            
            selectedCustomerData = {
                id: customerId,
                name: customerName,
                contact: contactInfo
            };
        }

        function selectNewCustomer(customerName) {
            document.getElementById('customerSearchInput').value = customerName;
            document.getElementById('selectedCustomerId').value = 'new';
            document.getElementById('customerSuggestions').style.display = 'none';
            
            selectedCustomerData = {
                id: 'new',
                name: customerName,
                contact: ''
            };
        }

        function loadCustomerForTable() {
            const tableId = document.getElementById('billTableSelect').value;
            const searchInput = document.getElementById('customerSearchInput');
            const checkinAlert = document.getElementById('checkinAlert');
            
            if (!tableId) {
                searchInput.value = '';
                document.getElementById('selectedCustomerId').value = '';
                checkinAlert.style.display = 'none';
                return;
            }

            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id == tableId);
            
            // Check if room needs check-in
            if (table && table.type === 'Room' && !table.checkedIn) {
                checkinAlert.style.display = 'block';
                searchInput.placeholder = 'Enter customer name for check-in...';
                selectedTableForCheckin = tableId;
                return;
            } else {
                checkinAlert.style.display = 'none';
                searchInput.placeholder = 'Type customer name to search...';
            }

            // If table is occupied, load the existing customer
            if (table && table.status === 'occupied' && table.order.customerName) {
                searchInput.value = table.order.customerName;
                document.getElementById('selectedCustomerId').value = table.order.customerId;
                selectedCustomerData = {
                    id: table.order.customerId,
                    name: table.order.customerName,
                    contact: ''
                };
                
                // Check if table has items and toggle actions
                hasItemsInOrder = table.order.items.length > 0;
                toggleBillFormActions();
            }
        }

        function loadMenuDropdown() {
            const menuItems = RestaurantDB.menu.getAll();
            const select = document.getElementById('billMenuSelect');
            
            select.innerHTML = '<option value="">Select Menu Item</option>';
            menuItems.forEach(item => {
                select.innerHTML += `<option value="${item.id}" data-price="${item.price}">${item.name} - ₹${item.price}</option>`;
            });
        }

        function addItemToTableOrder() {
            const tableId = document.getElementById('billTableSelect').value;
            const customerName = document.getElementById('customerSearchInput').value.trim();
            const customerId = document.getElementById('selectedCustomerId').value;
            const menuSelect = document.getElementById('billMenuSelect');
            const selectedMenuItem = menuSelect.options[menuSelect.selectedIndex];
            const quantity = parseInt(document.getElementById('billQuantity').value);

            if (!tableId) {
                showNotification('Please select a table/room first', 'error');
                return;
            }

            // Check if room needs check-in first
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id == tableId);
            if (table && table.type === 'Room' && !table.checkedIn) {
                showNotification('Please check-in to the room first before adding items', 'error');
                return;
            }

            if (!customerName) {
                showNotification('Please enter customer name', 'error');
                return;
            }

            if (!selectedMenuItem.value || !quantity) {
                showNotification('Please select menu item and quantity', 'error');
                return;
            }

            let finalCustomerName = customerName;
            let finalCustomerId = customerId;

            // Add new customer if needed
            if (!customerId || customerId === 'new') {
                RestaurantDB.customers.save({ name: customerName, phone: '', email: '', address: '' });
                const customers = RestaurantDB.customers.getAll();
                const newCustomer = customers[customers.length - 1];
                finalCustomerId = newCustomer.id;
                finalCustomerName = customerName;
            }

            const price = parseFloat(selectedMenuItem.dataset.price);

            // Add item to table order
            const success = RestaurantDB.tables.addItemToOrder(tableId, {
                menuId: parseInt(selectedMenuItem.value),
                name: selectedMenuItem.textContent.split(' - ')[0],
                price,
                quantity
            }, {
                customerId: finalCustomerId,
                customerName: finalCustomerName
            });

            if (success) {
                showNotification(`${quantity}x ${selectedMenuItem.textContent.split(' - ')[0]} added to order!`);
                // Clear form selections but keep table and customer
                document.getElementById('billMenuSelect').value = '';
                document.getElementById('billQuantity').value = '1';
                
                // Update form state
                hasItemsInOrder = true;
                toggleBillFormActions();
                
                loadTables();
                loadActiveOrders();
                updateStats();
            } else {
                showNotification('Failed to add item. Room may need check-in first.', 'error');
            }
        }

        function generateBillFromForm() {
            const tableId = document.getElementById('billTableSelect').value;
            
            if (!tableId) {
                showNotification('Please select a table first', 'error');
                return;
            }

            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id == tableId);
            
            if (!table || table.order.items.length === 0) {
                showNotification('Please add items to the order first', 'error');
                return;
            }

            generateBillFromTableData(table);
        }

        function deleteOrderWithoutBill() {
            const tableId = document.getElementById('billTableSelect').value;
            
            if (!tableId) {
                showNotification('Please select a table first', 'error');
                return;
            }

            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id == tableId);
            
            if (!table || table.order.items.length === 0) {
                showNotification('No order to cancel', 'error');
                return;
            }

            if (confirm(`Cancel order for ${table.type} ${table.number}? This will remove all items without generating a bill.`)) {
                RestaurantDB.tables.clearOrder(tableId, true); // true = is cancellation
                showNotification('Order cancelled successfully without generating bill!');
                hideBillForm();
                loadTables();
                loadActiveOrders();
                updateStats();
            }
        }

        function generateBillFromTableData(table) {
            // Calculate total including room price if it's a room
            let finalTotal = table.order.total;
            let roomCharge = 0;
            
            if (table.type === 'Room' && table.price > 0) {
                roomCharge = table.price;
                finalTotal += roomCharge;
            }

            // Generate bill with room charge included
            const bill = RestaurantDB.bills.save({
                tableId: table.id,
                tableNumber: `${table.type} ${table.number}`,
                customerId: table.order.customerId,
                customerName: table.order.customerName,
                customerPhone: getCustomerPhone(table.order.customerId),
                customerEmail: getCustomerEmail(table.order.customerId),
                items: table.order.items,
                roomCharge: roomCharge,
                itemsTotal: table.order.total,
                total: finalTotal
            });

            // Update customer spending with final total
            if (table.order.customerId) {
                RestaurantDB.customers.updateSpent(table.order.customerId, finalTotal);
            }

            // Clear order but don't check out room automatically
            RestaurantDB.tables.clearOrder(table.id, false); // false = not cancellation

            showNotification('Bill generated successfully!');
            displayBill(bill, table);
            loadTables();
            loadActiveOrders();
            updateStats();
        }

        function getCustomerPhone(customerId) {
            if (!customerId) return '';
            const customers = RestaurantDB.customers.getAll();
            const customer = customers.find(c => c.id == customerId);
            return customer ? customer.phone : '';
        }

        function getCustomerEmail(customerId) {
            if (!customerId) return '';
            const customers = RestaurantDB.customers.getAll();
            const customer = customers.find(c => c.id == customerId);
            return customer ? customer.email : '';
        }

        // Enhanced Bill Display with WhatsApp & Email Sharing
        function displayBill(bill, table) {
            const billDisplay = document.getElementById('billDisplay');
            
            billDisplay.innerHTML = `
                <div class="bill-header">
                    <h2>THYNK POS</h2>
                    <p>Bill #${bill.id.toString().slice(-6)}</p>
                    <p>${new Date(bill.date).toLocaleString()}</p>
                </div>
                
                <div>
                    <p><strong>Customer:</strong> ${bill.customerName}</p>
                    <p><strong>Table:</strong> ${bill.tableNumber}</p>
                    ${bill.customerPhone ? `<p><strong>Phone:</strong> ${bill.customerPhone}</p>` : ''}
                </div>
                
                <div class="bill-items">
                    ${bill.items.map(item => `
                        <div class="bill-item">
                            <span>${item.name} x${item.quantity}</span>
                            <span>₹${item.total.toFixed(2)}</span>
                        </div>
                    `).join('')}
                    ${bill.roomCharge > 0 ? `
                        <div class="bill-room-charge">
                            <span>${table.type} Charge (₹${bill.roomCharge}/night)</span>
                            <span>₹${bill.roomCharge.toFixed(2)}</span>
                        </div>
                    ` : ''}
                </div>
                
                ${bill.roomCharge > 0 ? `
                    <div style="margin: 1rem 0; padding: 0.75rem; background: var(--light); border-radius: 8px; border-left: 4px solid var(--info);">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Items Subtotal:</span>
                            <span>₹${bill.itemsTotal.toFixed(2)}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; font-weight: 600; color: var(--warning);">
                            <span>${table.type} Charge:</span>
                            <span>₹${bill.roomCharge.toFixed(2)}</span>
                        </div>
                    </div>
                ` : ''}
                
                <div class="bill-total">
                    Total: ₹${bill.total.toFixed(2)}
                </div>
                
                <div class="bill-actions">
                    <button class="btn btn-sm btn-primary" onclick="printBill(${bill.id})">
                        <span class="material-icons-outlined">print</span>
                        Print
                    </button>
                    
                    ${bill.customerPhone ? `
                        <button class="btn btn-sm whatsapp-btn" onclick="shareOnWhatsApp(${bill.id})">
                            <span class="material-icons-outlined">chat</span>
                            WhatsApp
                        </button>
                    ` : ''}
                    
                    ${bill.customerEmail ? `
                        <button class="btn btn-sm email-btn" onclick="shareViaEmail(${bill.id})">
                            <span class="material-icons-outlined">email</span>
                            Email
                        </button>
                    ` : ''}
                    
                    <button class="btn btn-sm btn-success" onclick="shareBill(${bill.id})">
                        <span class="material-icons-outlined">share</span>
                        Share
                    </button>
                    
                    <button class="btn btn-sm btn-info" onclick="downloadBillImage(${bill.id})">
                        <span class="material-icons-outlined">download</span>
                        Download
                    </button>
                    
                    <button class="btn btn-sm btn-danger" onclick="deleteBill(${bill.id})">
                        <span class="material-icons-outlined">delete</span>
                        Delete
                    </button>
                    
                    <button class="btn btn-sm btn-warning" onclick="closeBillModal()">
                        <span class="material-icons-outlined">close</span>
                        Close
                    </button>
                </div>
            `;
            
            document.getElementById('billModal').classList.add('show');
        }

        // Checkout Bill Display with Sharing Options
        function displayCheckoutBill(bill, table) {
            const checkoutBillContent = document.getElementById('checkoutBillContent');
            
            checkoutBillContent.innerHTML = `
                <div class="bill-display">
                    <div class="bill-header">
                        <h2>THYNK POS - CHECKOUT BILL</h2>
                        <p>Bill #${bill.id.toString().slice(-6)}</p>
                        <p>${new Date(bill.date).toLocaleString()}</p>
                    </div>
                    
                    <div>
                        <p><strong>Customer:</strong> ${bill.customerName}</p>
                        <p><strong>Room:</strong> ${bill.tableNumber}</p>
                        <p><strong>Check-out:</strong> ${new Date().toLocaleString()}</p>
                        ${bill.customerPhone ? `<p><strong>Phone:</strong> ${bill.customerPhone}</p>` : ''}
                    </div>
                    
                    <div class="bill-items">
                        ${bill.items.length > 0 ? bill.items.map(item => `
                            <div class="bill-item">
                                <span>${item.name} x${item.quantity}</span>
                                <span>₹${item.total.toFixed(2)}</span>
                            </div>
                        `).join('') : '<p style="text-align: center; color: var(--text-light);">No items ordered</p>'}
                        ${bill.roomCharge > 0 ? `
                            <div class="bill-room-charge">
                                <span>Room Charge (₹${bill.roomCharge}/night)</span>
                                <span>₹${bill.roomCharge.toFixed(2)}</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="bill-total">
                        Total: ₹${bill.total.toFixed(2)}
                    </div>
                    
                    <div class="bill-actions">
                        <button class="btn btn-sm btn-primary" onclick="printBill(${bill.id})">
                            <span class="material-icons-outlined">print</span>
                            Print
                        </button>
                        
                        ${bill.customerPhone ? `
                            <button class="btn btn-sm whatsapp-btn" onclick="shareOnWhatsApp(${bill.id})">
                                <span class="material-icons-outlined">chat</span>
                                WhatsApp
                            </button>
                        ` : ''}
                        
                        ${bill.customerEmail ? `
                            <button class="btn btn-sm email-btn" onclick="shareViaEmail(${bill.id})">
                                <span class="material-icons-outlined">email</span>
                                Email
                            </button>
                        ` : ''}
                        
                        <button class="btn btn-sm btn-success" onclick="shareBill(${bill.id})">
                            <span class="material-icons-outlined">share</span>
                            Share
                        </button>
                        
                        <button class="btn btn-sm btn-warning" onclick="closeCheckoutBillModal()">
                            <span class="material-icons-outlined">close</span>
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('checkoutBillModal').classList.add('show');
        }

        function closeCheckoutBillModal() {
            document.getElementById('checkoutBillModal').classList.remove('show');
        }

        // WhatsApp Sharing Function
        function shareOnWhatsApp(billId) {
            const bills = RestaurantDB.bills.getAll();
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;

            const billText = `
*THYNK POS - Bill #${bill.id.toString().slice(-6)}*

📅 Date: ${new Date(bill.date).toLocaleString()}
👤 Customer: ${bill.customerName}
🏠 Table: ${bill.tableNumber}

*Items:*
${bill.items.map(item => `• ${item.name} x${item.quantity} = ₹${item.total.toFixed(2)}`).join('\n')}
${bill.roomCharge > 0 ? `\n🏨 Room Charge: ₹${bill.roomCharge.toFixed(2)}` : ''}

*Total: ₹${bill.total.toFixed(2)}*

Thank you for your business! 🙏
_Powered by Thynk POS v1.5 - Created by Anas Lila_
            `;

            const phoneNumber = bill.customerPhone.replace(/[^0-9]/g, '');
            const whatsappUrl = `https://wa.me/${phoneNumber.startsWith('91') ? phoneNumber : '91' + phoneNumber}?text=${encodeURIComponent(billText)}`;
            
            window.open(whatsappUrl, '_blank');
            showNotification('Opening WhatsApp to send bill...');
        }

        // Email Sharing Function
        function shareViaEmail(billId) {
            const bills = RestaurantDB.bills.getAll();
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;

            const subject = `Bill #${bill.id.toString().slice(-6)} - Thynk POS`;
            const body = `
Dear ${bill.customerName},

Thank you for your business! Here's your bill:

Bill #: ${bill.id.toString().slice(-6)}
Date: ${new Date(bill.date).toLocaleString()}
Customer: ${bill.customerName}
Table: ${bill.tableNumber}

Items:
${bill.items.map(item => `${item.name} x${item.quantity} = ₹${item.total.toFixed(2)}`).join('\n')}
${bill.roomCharge > 0 ? `\nRoom Charge: ₹${bill.roomCharge.toFixed(2)}` : ''}

Total: ₹${bill.total.toFixed(2)}

Thank you for choosing us!

Best regards,
Your Restaurant Team

Powered by Thynk POS v1.5 - Created by Anas Lila
            `;

            const mailtoUrl = `mailto:${bill.customerEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            window.open(mailtoUrl);
            showNotification('Opening email client to send bill...');
        }

        function deleteBill(billId) {
            if (confirm('Delete this bill? This action cannot be undone and is useful if customer cancels the order.')) {
                const success = RestaurantDB.bills.delete(billId);
                if (success) {
                    showNotification('Bill deleted successfully! Order cancelled.');
                    closeBillModal();
                    closeCheckoutBillModal();
                    updateStats();
                } else {
                    showNotification('Error deleting bill', 'error');
                }
            }
        }

        function printBill(billId) {
            const bills = RestaurantDB.bills.getAll();
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;

            const printContent = `
                <div style="max-width: 400px; margin: 0 auto; font-family: monospace;">
                    <h2 style="text-align: center;">THYNK POS</h2>
                    <p style="text-align: center;">Hotel Management System</p>
                    <hr>
                    <p><strong>Bill #:</strong> ${bill.id.toString().slice(-6)}</p>
                    <p><strong>Date:</strong> ${new Date(bill.date).toLocaleString()}</p>
                    <p><strong>Customer:</strong> ${bill.customerName}</p>
                    <p><strong>Table:</strong> ${bill.tableNumber}</p>
                    ${bill.customerPhone ? `<p><strong>Phone:</strong> ${bill.customerPhone}</p>` : ''}
                    <hr>
                    ${bill.items.map(item => `
                        <p>${item.name} x${item.quantity} = ₹${item.total.toFixed(2)}</p>
                    `).join('')}
                    ${bill.roomCharge > 0 ? `
                        <hr>
                        <p>Room Charge = ₹${bill.roomCharge.toFixed(2)}</p>
                    ` : ''}
                    <hr>
                    <p style="font-size: 18px;"><strong>Total: ₹${bill.total.toFixed(2)}</strong></p>
                    <hr>
                    <p style="text-align: center;">Thank you for your business!</p>
                    <p style="text-align: center; font-size: 12px; margin-top: 20px;">Powered by Thynk POS v1.5 - Created by Anas Lila</p>
                </div>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(printContent);
            printWindow.print();
            showNotification('Bill sent to printer!');
        }

        function shareBill(billId) {
            const bills = RestaurantDB.bills.getAll();
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;

            const billText = `
THYNK POS - Bill #${bill.id.toString().slice(-6)}
Date: ${new Date(bill.date).toLocaleString()}
Customer: ${bill.customerName}
Table: ${bill.tableNumber}

Items:
${bill.items.map(item => `${item.name} x${item.quantity} = ₹${item.total.toFixed(2)}`).join('\n')}
${bill.roomCharge > 0 ? `\nRoom Charge: ₹${bill.roomCharge.toFixed(2)}` : ''}

Total: ₹${bill.total.toFixed(2)}

Thank you for your business!
Powered by Thynk POS v1.5 - Created by Anas Lila
            `;

            if (navigator.share) {
                navigator.share({
                    title: `Bill #${bill.id.toString().slice(-6)}`,
                    text: billText
                });
            } else {
                navigator.clipboard.writeText(billText);
                showNotification('Bill copied to clipboard!');
            }
        }

        function downloadBillImage(billId) {
            const bills = RestaurantDB.bills.getAll();
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;

            const billData = `data:text/plain;charset=utf-8,${encodeURIComponent(`
THYNK POS - Bill #${bill.id.toString().slice(-6)}
Date: ${new Date(bill.date).toLocaleString()}
Customer: ${bill.customerName}
Table: ${bill.tableNumber}
${bill.customerPhone ? `Phone: ${bill.customerPhone}` : ''}

Items:
${bill.items.map(item => `${item.name} x${item.quantity} = ₹${item.total.toFixed(2)}`).join('\n')}
${bill.roomCharge > 0 ? `\nRoom Charge: ₹${bill.roomCharge.toFixed(2)}` : ''}

Total: ₹${bill.total.toFixed(2)}

Thank you for your business!
Powered by Thynk POS v1.5 - Created by Anas Lila
            `)}`;

            const downloadLink = document.createElement('a');
            downloadLink.href = billData;
            downloadLink.download = `bill-${bill.id}.txt`;
            downloadLink.click();
            showNotification('Bill downloaded!');
        }

        function closeBillModal() {
            document.getElementById('billModal').classList.remove('show');
        }

        function loadActiveOrders() {
            const tables = RestaurantDB.tables.getAll().filter(t => t.status === 'occupied' && t.order.items.length > 0);
            const container = document.getElementById('activeOrders');
            
            if (tables.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🛒</div>
                        <h3>No Active Orders</h3>
                        <p>Add items to tables to see active orders here</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = tables.map(table => `
                <div class="card">
                    <h3>${table.type} ${table.number} - ${table.order.customerName}</h3>
                    ${table.type === 'Room' ? `<p><small>${table.checkedIn ? '✅ Checked In' : '🔒 Not Checked In'}</small></p>` : ''}
                    <div style="max-height: 150px; overflow-y: auto; margin: 1rem 0;">
                        ${table.order.items.map(item => `
                            <div style="display: flex; justify-content: space-between; padding: 0.25rem 0; border-bottom: 1px solid var(--light);">
                                <span>${item.name} x${item.quantity}</span>
                                <span>₹${item.total.toFixed(2)}</span>
                            </div>
                        `).join('')}
                        ${table.type === 'Room' && table.price > 0 ? `
                            <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border); background: rgba(245, 158, 11, 0.1); border-radius: 4px; margin: 0.25rem 0; padding-left: 0.5rem; padding-right: 0.5rem; font-weight: 600; color: var(--warning);">
                                <span>Room Charge</span>
                                <span>₹${table.price.toFixed(2)}</span>
                            </div>
                        ` : ''}
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: var(--success); color: white; border-radius: 8px; text-align: center; font-weight: 600;">
                        Total (${table.type === 'Room' && table.price > 0 ? 'with room charge' : 'items only'}): ₹${(table.order.total + (table.type === 'Room' ? table.price : 0)).toFixed(2)}
                    </div>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-sm btn-success" onclick="generateBillFromTableData(${JSON.stringify(table).replace(/"/g, '&quot;')})">
                            <span class="material-icons-outlined">receipt</span>
                            Generate Bill
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="cancelOrderFromActive(${table.id})">
                            <span class="material-icons-outlined">cancel</span>
                            Cancel Order
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function cancelOrderFromActive(tableId) {
            const tables = RestaurantDB.tables.getAll();
            const table = tables.find(t => t.id === tableId);
            
            if (!table) return;

            if (confirm(`Cancel order for ${table.type} ${table.number}? All items will be removed without generating a bill.`)) {
                RestaurantDB.tables.clearOrder(tableId, true); // true = is cancellation
                showNotification('Order cancelled successfully without generating bill!');
                loadTables();
                loadActiveOrders();
                updateStats();
            }
        }

        // Bulk Excel Import Functions
        
        // Menu Template Download
        function downloadMenuTemplate() {
            const template = [
                ['Item Name', 'Price', 'Category', 'Description'],
                ['Butter Chicken', '320', 'Main Course', 'Creamy tomato-based chicken curry'],
                ['Paneer Tikka', '280', 'Starters', 'Grilled cottage cheese with spices'],
                ['Dal Makhani', '220', 'Dal', 'Rich black lentils in creamy gravy'],
                ['Basmati Rice', '180', 'Rice', 'Fragrant long grain rice'],
                ['Garlic Naan', '80', 'Bread', 'Leavened bread with garlic'],
                ['Fresh Lime Soda', '60', 'Beverages', 'Refreshing lime drink'],
                ['Gulab Jamun', '120', 'Desserts', 'Sweet milk dumplings in syrup']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Menu Template');
            
            XLSX.writeFile(wb, 'Thynk_POS_Menu_Template.xlsx');
            showNotification('Menu template downloaded! Fill it and import back.');
        }

        // Customer Template Download
        function downloadCustomerTemplate() {
            const template = [
                ['Customer Name', 'Phone Number', 'Email Address', 'Address'],
                ['John Doe', '9876543210', 'john@example.com', '123 Main Street, City'],
                ['Jane Smith', '9876543211', 'jane@example.com', '456 Oak Avenue, City'],
                ['Mike Johnson', '9876543212', 'mike@example.com', '789 Pine Road, City'],
                ['Sarah Wilson', '9876543213', 'sarah@example.com', '321 Elm Street, City']
            ];
            
            const ws = XLSX.utils.aoa_to_sheet(template);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Customer Template');
            
            XLSX.writeFile(wb, 'Thynk_POS_Customer_Template.xlsx');
            showNotification('Customer template downloaded! Fill it and import back.');
        }

        // Menu Excel Import
        function importMenuFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // Skip header row and process data
                    const menuItems = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row[0] && row[1] && row[2]) { // Name, Price, Category required
                            menuItems.push({
                                name: row[0],
                                price: parseFloat(row[1]) || 0,
                                category: row[2],
                                description: row[3] || ''
                            });
                        }
                    }
                    
                    if (menuItems.length > 0) {
                        const addedCount = RestaurantDB.menu.bulkSave(menuItems);
                        showNotification(`Successfully imported ${addedCount} menu items!`);
                        loadMenuItems();
                        loadBillingDropdowns();
                        updateStats();
                    } else {
                        showNotification('No valid menu items found in the file', 'error');
                    }
                } catch (error) {
                    showNotification('Error reading Excel file. Please check the format.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Customer Excel Import
        function importCustomersFromExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    // Skip header row and process data
                    const customers = [];
                    for (let i = 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (row[0] && row[1]) { // Name and Phone required
                            customers.push({
                                name: row[0],
                                phone: row[1].toString(),
                                email: row[2] || '',
                                address: row[3] || ''
                            });
                        }
                    }
                    
                    if (customers.length > 0) {
                        const addedCount = RestaurantDB.customers.bulkSave(customers);
                        showNotification(`Successfully imported ${addedCount} customers!`);
                        loadCustomers();
                        loadBillingDropdowns();
                        updateStats();
                    } else {
                        showNotification('No valid customers found in the file', 'error');
                    }
                } catch (error) {
                    showNotification('Error reading Excel file. Please check the format.', 'error');
                }
            };
            reader.readAsArrayBuffer(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Menu Management Functions
        function showAddMenuForm() {
            document.getElementById('menuForm').style.display = 'block';
            document.getElementById('menuItemName').focus();
        }

        function hideMenuForm() {
            document.getElementById('menuForm').style.display = 'none';
            clearMenuForm();
        }

        function clearMenuForm() {
            document.getElementById('menuItemName').value = '';
            document.getElementById('menuItemPrice').value = '';
            document.getElementById('menuItemCategory').value = '';
            document.getElementById('menuItemDescription').value = '';
        }

        function saveMenuItem() {
            const name = document.getElementById('menuItemName').value.trim();
            const price = document.getElementById('menuItemPrice').value.trim();
            const category = document.getElementById('menuItemCategory').value;
            const description = document.getElementById('menuItemDescription').value.trim();

            if (!name || !price || !category) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            if (parseFloat(price) <= 0) {
                showNotification('Price must be greater than 0', 'error');
                return;
            }

            RestaurantDB.menu.save({ name, price, category, description });
            showNotification(`"${name}" added to menu!`);
            
            hideMenuForm();
            loadMenuItems();
            loadBillingDropdowns();
            updateStats();
        }

        function loadMenuItems() {
            const menuItems = RestaurantDB.menu.getAll();
            const container = document.getElementById('menuItems');
            
            if (menuItems.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🍽️</div>
                        <h3>No Menu Items Yet</h3>
                        <p>Add menu items manually or use bulk import</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = menuItems.map(item => `
                <div class="card">
                    <h3>${item.name}</h3>
                    <p><strong>₹${item.price.toFixed(2)}</strong></p>
                    <p><strong>Category:</strong> ${item.category}</p>
                    <p>${item.description || 'No description'}</p>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-sm btn-primary" onclick="editMenuItem(${item.id})">
                            <span class="material-icons-outlined">edit</span>
                            Edit
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteMenuItem(${item.id}, '${item.name.replace(/'/g, "\\'")}')">
                            <span class="material-icons-outlined">delete</span>
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function editMenuItem(id) {
            const menuItems = RestaurantDB.menu.getAll();
            const item = menuItems.find(m => m.id === id);
            if (!item) return;

            document.getElementById('menuItemName').value = item.name;
            document.getElementById('menuItemPrice').value = item.price;
            document.getElementById('menuItemCategory').value = item.category;
            document.getElementById('menuItemDescription').value = item.description;
            
            // Change save button to update
            document.querySelector('#menuForm .btn-success').onclick = () => updateMenuItem(id);
            document.querySelector('#menuForm .btn-success').innerHTML = '<span class="material-icons-outlined">update</span> Update Menu Item';
            
            showAddMenuForm();
        }

        function updateMenuItem(id) {
            const name = document.getElementById('menuItemName').value.trim();
            const price = document.getElementById('menuItemPrice').value.trim();
            const category = document.getElementById('menuItemCategory').value;
            const description = document.getElementById('menuItemDescription').value.trim();

            if (!name || !price || !category) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }

            RestaurantDB.menu.update(id, { name, price: parseFloat(price), category, description });
            showNotification(`"${name}" updated successfully!`);
            
            // Reset save button
            document.querySelector('#menuForm .btn-success').onclick = saveMenuItem;
            document.querySelector('#menuForm .btn-success').innerHTML = '<span class="material-icons-outlined">save</span> Save Menu Item';
            
            hideMenuForm();
            loadMenuItems();
            loadBillingDropdowns();
        }

        function deleteMenuItem(id, name) {
            if (confirm(`Delete "${name}" from menu?`)) {
                RestaurantDB.menu.delete(id);
                showNotification(`"${name}" deleted successfully`);
                loadMenuItems();
                loadBillingDropdowns();
                updateStats();
            }
        }

        // Customer Management Functions
        function showAddCustomerForm() {
            editingCustomerId = null;
            document.getElementById('customerFormTitle').textContent = 'Add New Customer';
            document.getElementById('customerForm').style.display = 'block';
            document.getElementById('customerName').focus();
        }

        function hideCustomerForm() {
            document.getElementById('customerForm').style.display = 'none';
            clearCustomerForm();
            editingCustomerId = null;
        }

        function clearCustomerForm() {
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerEmail').value = '';
            document.getElementById('customerAddress').value = '';
        }

        function saveCustomer() {
            const name = document.getElementById('customerName').value.trim();
            const phone = document.getElementById('customerPhone').value.trim();
            const email = document.getElementById('customerEmail').value.trim();
            const address = document.getElementById('customerAddress').value.trim();

            if (!name || !phone) {
                showNotification('Please fill in name and phone number', 'error');
                return;
            }

            if (editingCustomerId) {
                RestaurantDB.customers.update(editingCustomerId, { name, phone, email, address });
                showNotification(`Customer "${name}" updated successfully!`);
            } else {
                RestaurantDB.customers.save({ name, phone, email, address });
                showNotification(`Customer "${name}" added successfully!`);
            }

            hideCustomerForm();
            loadCustomers();
            loadBillingDropdowns();
            updateStats();
        }

        function editCustomer(id) {
            const customers = RestaurantDB.customers.getAll();
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            editingCustomerId = id;
            document.getElementById('customerFormTitle').textContent = 'Edit Customer';
            document.getElementById('customerName').value = customer.name;
            document.getElementById('customerPhone').value = customer.phone;
            document.getElementById('customerEmail').value = customer.email;
            document.getElementById('customerAddress').value = customer.address;
            document.getElementById('customerForm').style.display = 'block';
        }

        function loadCustomers() {
            const customers = RestaurantDB.customers.getAll();
            const container = document.getElementById('customersList');
            
            if (customers.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">👥</div>
                        <h3>No Customers Added Yet</h3>
                        <p>Add customers manually or use bulk import</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = customers.map(customer => `
                <div class="card">
                    <h3>${customer.name}</h3>
                    <p><strong>Phone:</strong> ${customer.phone}</p>
                    <p><strong>Email:</strong> ${customer.email || 'N/A'}</p>
                    <p><strong>Address:</strong> ${customer.address || 'N/A'}</p>
                    <p><strong>Total Orders:</strong> ${customer.totalOrders}</p>
                    <p><strong>Total Spent:</strong> ₹${customer.totalSpent.toFixed(2)}</p>
                    <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                        <button class="btn btn-sm btn-primary" onclick="editCustomer(${customer.id})">
                            <span class="material-icons-outlined">edit</span>
                            Edit
                        </button>
                        <button class="btn btn-sm btn-success" onclick="createBillForCustomer(${customer.id})">
                            <span class="material-icons-outlined">receipt</span>
                            Create Bill
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function createBillForCustomer(customerId) {
            const customers = RestaurantDB.customers.getAll();
            const customer = customers.find(c => c.id === customerId);
            
            switchTab('billing');
            setTimeout(() => {
                showNewBillForm();
                setTimeout(() => {
                    document.getElementById('customerSearchInput').value = customer.name;
                    document.getElementById('selectedCustomerId').value = customerId;
                    selectedCustomerData = {
                        id: customerId,
                        name: customer.name,
                        contact: customer.phone || customer.email || customer.address || ''
                    };
                }, 100);
            }, 300);
        }

        // History & Reports Functions
        function loadHistory() {
            const history = RestaurantDB.history.getAll();
            const container = document.getElementById('historyTimeline');
            
            if (history.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <h3>No History Yet</h3>
                        <p>Activity history will appear here</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = history.map(entry => `
                <div class="history-item">
                    <div class="history-icon">
                        <span class="material-icons-outlined">${entry.icon}</span>
                    </div>
                    <div class="history-content">
                        <div class="history-title">${entry.title}</div>
                        <div class="history-details">${entry.details}</div>
                        <div class="history-time">${new Date(entry.timestamp).toLocaleString()}</div>
                    </div>
                </div>
            `).join('');
        }

        function clearAllHistory() {
            if (confirm('Clear all history? This cannot be undone.')) {
                RestaurantDB.history.clear();
                loadHistory();
                showNotification('History cleared successfully!');
            }
        }

        // Subscription Functions
        function showSubscriptionTab() {
            switchTab('subscription');
        }

        function applyPromoCode() {
            const promoCode = document.getElementById('promoCode').value.trim().toUpperCase();
            const originalPriceEl = document.getElementById('originalPrice');
            const finalPriceEl = document.getElementById('finalPrice');
            const discountBadgeEl = document.getElementById('discountBadge');

            if (promoCode === 'THP25') {
                originalPriceEl.style.display = 'block';
                finalPriceEl.textContent = '₹499';
                discountBadgeEl.style.display = 'inline-block';
                discountApplied = true;
                showNotification('Promo code applied! ₹500 discount activated!');
            } else if (promoCode === '') {
                showNotification('Please enter a promo code', 'error');
            } else {
                showNotification('Invalid promo code. Try THP25 for ₹500 off!', 'error');
            }
        }

        function redirectToGooglePay() {
            const amount = discountApplied ? 499 : 999;
            const gpayUrl = `https://pay.google.com/pay?pa=anaslila@icici&pn=Thynk%20POS%20Subscription&am=${amount}&cu=INR&tn=Thynk%20POS%20Lifetime%20Access`;
            window.open(gpayUrl, '_blank');
            showNotification('Redirecting to Google Pay...');
        }

        function redirectToUPI() {
            const amount = discountApplied ? 499 : 999;
            const upiUrl = `upi://pay?pa=anaslila@icici&pn=Thynk%20POS%20Subscription&am=${amount}&cu=INR&tn=Thynk%20POS%20Lifetime%20Access`;
            window.open(upiUrl, '_blank');
            showNotification('Opening UPI apps...');
        }

        function generatePaymentQR() {
            const amount = discountApplied ? 499 : 999;
            const qrContainer = document.getElementById('qrContainer');
            const qrCodeImage = document.getElementById('qrCodeImage');
            const qrAmountElement = document.getElementById('qrAmount');
            
            qrAmountElement.textContent = `₹${amount}`;
            
            const upiString = `upi://pay?pa=anaslila@icici&pn=Thynk%20POS%20Subscription&am=${amount}&cu=INR&tn=Thynk%20POS%20Lifetime%20Access`;
            const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(upiString)}`;
            
            qrCodeImage.src = qrURL;
            qrContainer.style.display = 'block';
            
            showNotification('QR Code generated! Scan to pay with any UPI app');
        }

        // Statistics Update
        function updateStats() {
            const tables = RestaurantDB.tables.getAll();
            const bills = RestaurantDB.bills.getAll();
            const customers = RestaurantDB.customers.getAll();
            const menuItems = RestaurantDB.menu.getAll();
            
            document.getElementById('totalTables').textContent = tables.length;
            document.getElementById('billCount').textContent = bills.length;
            document.getElementById('customerCount').textContent = customers.length;
            document.getElementById('menuCount').textContent = menuItems.length;
            document.getElementById('tableCount').textContent = tables.length;
        }

        // Notification System
        function showNotification(message, type = 'success') {
            document.querySelectorAll('.notification').forEach(n => n.remove());
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            updateStats();
            loadTables();
            
            // Initialize customer search on first load
            setTimeout(() => {
                if (document.getElementById('customerSearchInput')) {
                    setupCustomerSearch();
                }
            }, 100);
        });

        // Service Worker Registration for Offline Support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(URL.createObjectURL(new Blob([`
                const CACHE = 'thynk-pos-v1.5-final-complete';
                self.addEventListener('install', e => {
                    e.waitUntil(caches.open(CACHE).then(cache => cache.addAll(['/'])));
                });
                self.addEventListener('fetch', e => {
                    e.respondWith(caches.match(e.request).then(response => response || fetch(e.request)));
                });
            `], {type: 'application/javascript'})))
            .then(() => console.log('PWA Service Worker registered for complete offline support'));
        }
    </script>
</body>
</html>

